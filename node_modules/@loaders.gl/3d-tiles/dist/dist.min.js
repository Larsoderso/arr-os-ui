!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=46)}([function(t,e,r){"use strict";var n=r(34);r.d(e,"a",(function(){return n.a})),r.d(e,"b",(function(){return n.b})),r.d(e,"c",(function(){return n.c})),r.d(e,"d",(function(){return n.d})),r.d(e,"e",(function(){return n.e})),r.d(e,"f",(function(){return n.f})),r.d(e,"g",(function(){return n.g})),r.d(e,"h",(function(){return n.h})),r.d(e,"i",(function(){return n.i})),r.d(e,"j",(function(){return n.j})),r.d(e,"k",(function(){return n.k})),r.d(e,"l",(function(){return n.l})),r.d(e,"m",(function(){return n.m})),r.d(e,"n",(function(){return n.n}))},function(t,e,r){"use strict";r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return i})),r.d(e,"c",(function(){return s}));var n=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,s=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return a}));var n=r(4);function i(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function s(t,e,r){if(n.b.debug&&!function(t,e){if(t.length!==e)return!1;for(var r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(""|r," some fields set to invalid numbers'"));return t}var o={};function a(t,e){o[t]||(o[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}},function(t,e,r){"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}r.d(e,"a",(function(){return i}))},function(t,e,r){"use strict";r(23),r(25);r(14);r.d(e,"b",(function(){return s})),r.d(e,"e",(function(){return o})),r.d(e,"f",(function(){return a})),r.d(e,"h",(function(){return c})),r.d(e,"g",(function(){return h})),r.d(e,"c",(function(){return l})),r.d(e,"a",(function(){return f})),r.d(e,"d",(function(){return d}));var n=1/Math.PI*180,i=1/180*Math.PI,s={};function o(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,r=void 0===e?s.precision||4:e;return t=function(t){return Math.round(t/s.EPSILON)*s.EPSILON}(t),"".concat(parseFloat(t.toPrecision(r)))}function a(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function u(t,e,r){if(a(t)){r=r||((i=t).clone?i.clone():new Array(i.length));for(var n=0;n<r.length&&n<t.length;++n)r[n]=e(t[n],n,r);return r}var i;return e(t)}function c(t){return function(t,e){return u(t,(function(t){return t*i}),e)}(t)}function h(t){return l(t)}function l(t,e){return u(t,(function(t){return t*n}),e)}function f(t,e,r){return u(t,(function(t){return Math.max(e,Math.min(r,t))}))}function d(t,e,r){var n=s.EPSILON;r&&(s.EPSILON=r);try{if(t===e)return!0;if(a(t)&&a(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!d(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=s.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{s.EPSILON=n}}s.EPSILON=1e-12,s.debug=!1,s.precision=4,s.printTypes=!1,s.printDegrees=!1,s.printRowMajor=!0},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}r.d(e,"a",(function(){return n}))},function(t,e,r){"use strict";r.d(e,"b",(function(){return i})),r.d(e,"g",(function(){return s})),r.d(e,"e",(function(){return o})),r.d(e,"h",(function(){return a})),r.d(e,"d",(function(){return u})),r.d(e,"c",(function(){return c})),r.d(e,"m",(function(){return h})),r.d(e,"l",(function(){return l})),r.d(e,"n",(function(){return f})),r.d(e,"i",(function(){return d})),r.d(e,"j",(function(){return y})),r.d(e,"k",(function(){return m})),r.d(e,"a",(function(){return p})),r.d(e,"f",(function(){return b}));var n=r(1);function i(){var t=new n.a(3);return n.a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function s(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function o(t,e,r){var i=new n.a(3);return i[0]=t,i[1]=e,i[2]=r,i}function a(t,e){var r=e[0],n=e[1],i=e[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function u(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function c(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[0],a=r[1],u=r[2];return t[0]=i*u-s*a,t[1]=s*o-n*u,t[2]=n*a-i*o,t}function h(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[3]*n+r[7]*i+r[11]*s+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/o,t[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/o,t}function l(t,e,r){var n=e[0],i=e[1],s=e[2];return t[0]=n*r[0]+i*r[3]+s*r[6],t[1]=n*r[1]+i*r[4]+s*r[7],t[2]=n*r[2]+i*r[5]+s*r[8],t}function f(t,e,r){var n=r[0],i=r[1],s=r[2],o=r[3],a=e[0],u=e[1],c=e[2],h=i*c-s*u,l=s*a-n*c,f=n*u-i*a,d=i*f-s*l,y=s*h-n*f,m=n*l-i*h,p=2*o;return h*=p,l*=p,f*=p,d*=2,y*=2,m*=2,t[0]=a+h+d,t[1]=u+l+y,t[2]=c+f+m,t}function d(t,e,r,n){var i=[],s=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function y(t,e,r,n){var i=[],s=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function m(t,e,r,n){var i=[],s=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function p(t,e){var r=o(t[0],t[1],t[2]),n=o(e[0],e[1],e[2]);a(r,r),a(n,n);var i=u(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}var g,b=s;g=i()},,function(t,e,r){"use strict";r.d(e,"p",(function(){return i})),r.d(e,"e",(function(){return s})),r.d(e,"a",(function(){return o})),r.d(e,"g",(function(){return a})),r.d(e,"o",(function(){return u})),r.d(e,"n",(function(){return c})),r.d(e,"j",(function(){return h})),r.d(e,"k",(function(){return l})),r.d(e,"l",(function(){return f})),r.d(e,"m",(function(){return d})),r.d(e,"d",(function(){return y})),r.d(e,"b",(function(){return m})),r.d(e,"c",(function(){return p})),r.d(e,"i",(function(){return g})),r.d(e,"h",(function(){return b})),r.d(e,"f",(function(){return v}));var n=r(1);function i(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function s(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],d=e[11],y=e[12],m=e[13],p=e[14],g=e[15],b=r*a-n*o,v=r*u-i*o,_=r*c-s*o,w=n*u-i*a,T=n*c-s*a,O=i*c-s*u,E=h*m-l*y,S=h*p-f*y,A=h*g-d*y,k=l*p-f*m,x=l*g-d*m,N=f*g-d*p,M=b*N-v*x+_*k+w*A-T*S+O*E;return M?(M=1/M,t[0]=(a*N-u*x+c*k)*M,t[1]=(i*x-n*N-s*k)*M,t[2]=(m*O-p*T+g*w)*M,t[3]=(f*T-l*O-d*w)*M,t[4]=(u*A-o*N-c*S)*M,t[5]=(r*N-i*A+s*S)*M,t[6]=(p*_-y*O-g*v)*M,t[7]=(h*O-f*_+d*v)*M,t[8]=(o*x-a*A+c*E)*M,t[9]=(n*A-r*x-s*E)*M,t[10]=(y*T-m*_+g*b)*M,t[11]=(l*_-h*T-d*b)*M,t[12]=(a*S-o*k-u*E)*M,t[13]=(r*k-n*S+i*E)*M,t[14]=(m*v-y*w-p*b)*M,t[15]=(h*w-l*v+f*b)*M,t):null}function o(t){var e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],c=t[8],h=t[9],l=t[10],f=t[11],d=t[12],y=t[13],m=t[14],p=t[15];return(e*o-r*s)*(l*p-f*m)-(e*a-n*s)*(h*p-f*y)+(e*u-i*s)*(h*m-l*y)+(r*a-n*o)*(c*p-f*d)-(r*u-i*o)*(c*m-l*d)+(n*u-i*a)*(c*y-h*d)}function a(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],y=e[11],m=e[12],p=e[13],g=e[14],b=e[15],v=r[0],_=r[1],w=r[2],T=r[3];return t[0]=v*n+_*a+w*l+T*m,t[1]=v*i+_*u+w*f+T*p,t[2]=v*s+_*c+w*d+T*g,t[3]=v*o+_*h+w*y+T*b,v=r[4],_=r[5],w=r[6],T=r[7],t[4]=v*n+_*a+w*l+T*m,t[5]=v*i+_*u+w*f+T*p,t[6]=v*s+_*c+w*d+T*g,t[7]=v*o+_*h+w*y+T*b,v=r[8],_=r[9],w=r[10],T=r[11],t[8]=v*n+_*a+w*l+T*m,t[9]=v*i+_*u+w*f+T*p,t[10]=v*s+_*c+w*d+T*g,t[11]=v*o+_*h+w*y+T*b,v=r[12],_=r[13],w=r[14],T=r[15],t[12]=v*n+_*a+w*l+T*m,t[13]=v*i+_*u+w*f+T*p,t[14]=v*s+_*c+w*d+T*g,t[15]=v*o+_*h+w*y+T*b,t}function u(t,e,r){var n,i,s,o,a,u,c,h,l,f,d,y,m=r[0],p=r[1],g=r[2];return e===t?(t[12]=e[0]*m+e[4]*p+e[8]*g+e[12],t[13]=e[1]*m+e[5]*p+e[9]*g+e[13],t[14]=e[2]*m+e[6]*p+e[10]*g+e[14],t[15]=e[3]*m+e[7]*p+e[11]*g+e[15]):(n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],y=e[11],t[0]=n,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=c,t[7]=h,t[8]=l,t[9]=f,t[10]=d,t[11]=y,t[12]=n*m+a*p+l*g+e[12],t[13]=i*m+u*p+f*g+e[13],t[14]=s*m+c*p+d*g+e[14],t[15]=o*m+h*p+y*g+e[15]),t}function c(t,e,r){var n=r[0],i=r[1],s=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function h(t,e,r,i){var s,o,a,u,c,h,l,f,d,y,m,p,g,b,v,_,w,T,O,E,S,A,k,x,N=i[0],M=i[1],I=i[2],j=Math.hypot(N,M,I);return j<n.b?null:(N*=j=1/j,M*=j,I*=j,s=Math.sin(r),a=1-(o=Math.cos(r)),u=e[0],c=e[1],h=e[2],l=e[3],f=e[4],d=e[5],y=e[6],m=e[7],p=e[8],g=e[9],b=e[10],v=e[11],_=N*N*a+o,w=M*N*a+I*s,T=I*N*a-M*s,O=N*M*a-I*s,E=M*M*a+o,S=I*M*a+N*s,A=N*I*a+M*s,k=M*I*a-N*s,x=I*I*a+o,t[0]=u*_+f*w+p*T,t[1]=c*_+d*w+g*T,t[2]=h*_+y*w+b*T,t[3]=l*_+m*w+v*T,t[4]=u*O+f*E+p*S,t[5]=c*O+d*E+g*S,t[6]=h*O+y*E+b*S,t[7]=l*O+m*E+v*S,t[8]=u*A+f*k+p*x,t[9]=c*A+d*k+g*x,t[10]=h*A+y*k+b*x,t[11]=l*A+m*k+v*x,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function l(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[4],o=e[5],a=e[6],u=e[7],c=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*n,t[5]=o*i+h*n,t[6]=a*i+l*n,t[7]=u*i+f*n,t[8]=c*i-s*n,t[9]=h*i-o*n,t[10]=l*i-a*n,t[11]=f*i-u*n,t}function f(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[0],o=e[1],a=e[2],u=e[3],c=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*n,t[1]=o*i-h*n,t[2]=a*i-l*n,t[3]=u*i-f*n,t[8]=s*n+c*i,t[9]=o*n+h*i,t[10]=a*n+l*i,t[11]=u*n+f*i,t}function d(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[0],o=e[1],a=e[2],u=e[3],c=e[4],h=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*n,t[1]=o*i+h*n,t[2]=a*i+l*n,t[3]=u*i+f*n,t[4]=c*i-s*n,t[5]=h*i-o*n,t[6]=l*i-a*n,t[7]=f*i-u*n,t}function y(t,e){var r=e[0],n=e[1],i=e[2],s=e[4],o=e[5],a=e[6],u=e[8],c=e[9],h=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(u,c,h),t}function m(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r+r,a=n+n,u=i+i,c=r*o,h=n*o,l=n*a,f=i*o,d=i*a,y=i*u,m=s*o,p=s*a,g=s*u;return t[0]=1-l-y,t[1]=h+g,t[2]=f-p,t[3]=0,t[4]=h-g,t[5]=1-c-y,t[6]=d+m,t[7]=0,t[8]=f+p,t[9]=d-m,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function p(t,e,r,n,i,s,o){var a=1/(r-e),u=1/(i-n),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*u,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(i+n)*u,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function g(t,e,r,n,i){var s,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(s=1/(n-i),t[10]=(i+n)*s,t[14]=2*i*n*s):(t[10]=-1,t[14]=-2*n),t}function b(t,e,r,n,i,s,o){var a=1/(e-r),u=1/(n-i),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(i+n)*u,t[14]=(o+s)*c,t[15]=1,t}function v(t,e,r,i){var s,o,a,u,c,h,l,f,d,y,m=e[0],p=e[1],g=e[2],b=i[0],v=i[1],_=i[2],w=r[0],T=r[1],O=r[2];return Math.abs(m-w)<n.b&&Math.abs(p-T)<n.b&&Math.abs(g-O)<n.b?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(l=m-w,f=p-T,d=g-O,s=v*(d*=y=1/Math.hypot(l,f,d))-_*(f*=y),o=_*(l*=y)-b*d,a=b*f-v*l,(y=Math.hypot(s,o,a))?(s*=y=1/y,o*=y,a*=y):(s=0,o=0,a=0),u=f*a-d*o,c=d*s-l*a,h=l*o-f*s,(y=Math.hypot(u,c,h))?(u*=y=1/y,c*=y,h*=y):(u=0,c=0,h=0),t[0]=s,t[1]=u,t[2]=l,t[3]=0,t[4]=o,t[5]=c,t[6]=f,t[7]=0,t[8]=a,t[9]=h,t[10]=d,t[11]=0,t[12]=-(s*m+o*p+a*g),t[13]=-(u*m+c*p+h*g),t[14]=-(l*m+f*p+d*g),t[15]=1,t)}},function(t,e,r){"use strict";function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}r.d(e,"a",(function(){return n}))},function(t,e,r){"use strict";r.d(e,"b",(function(){return i})),r.d(e,"g",(function(){return s})),r.d(e,"c",(function(){return o})),r.d(e,"l",(function(){return a})),r.d(e,"a",(function(){return u})),r.d(e,"k",(function(){return c})),r.d(e,"h",(function(){return h})),r.d(e,"m",(function(){return l})),r.d(e,"j",(function(){return f})),r.d(e,"d",(function(){return d})),r.d(e,"i",(function(){return y})),r.d(e,"n",(function(){return m})),r.d(e,"o",(function(){return p})),r.d(e,"f",(function(){return g})),r.d(e,"e",(function(){return b}));var n=r(1);function i(t){var e=new n.a(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function s(t,e,r,i){var s=new n.a(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function o(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function u(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function c(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function h(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.hypot(e,r,n,i)}function l(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function f(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r*r+n*n+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=s*o,t}function d(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function y(t,e,r,n){var i=e[0],s=e[1],o=e[2],a=e[3];return t[0]=i+n*(r[0]-i),t[1]=s+n*(r[1]-s),t[2]=o+n*(r[2]-o),t[3]=a+n*(r[3]-a),t}function m(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*s+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*s+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*s+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*s+r[15]*o,t}function p(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[0],a=r[1],u=r[2],c=r[3],h=c*n+a*s-u*i,l=c*i+u*n-o*s,f=c*s+o*i-a*n,d=-o*n-a*i-u*s;return t[0]=h*c+d*-o+l*-u-f*-a,t[1]=l*c+d*-a+f*-o-h*-u,t[2]=f*c+d*-u+h*-a-l*-o,t[3]=e[3],t}function g(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function b(t,e){var r=t[0],i=t[1],s=t[2],o=t[3],a=e[0],u=e[1],c=e[2],h=e[3];return Math.abs(r-a)<=n.b*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=n.b*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(s-c)<=n.b*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(o-h)<=n.b*Math.max(1,Math.abs(o),Math.abs(h))}var v,_;v=new n.a(4),n.a!=Float32Array&&(v[0]=0,v[1]=0,v[2]=0,v[3]=0),_=v},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(18);function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Object(n.a)(t,e)}},function(t,e,r){"use strict";var n=r(23);function i(t,e){return!e||"object"!==Object(n.a)(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}r.d(e,"a",(function(){return i}))},function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"i",(function(){return s})),r.d(e,"d",(function(){return o})),r.d(e,"b",(function(){return a})),r.d(e,"e",(function(){return u})),r.d(e,"h",(function(){return c})),r.d(e,"f",(function(){return h})),r.d(e,"g",(function(){return l})),r.d(e,"c",(function(){return f}));var n=r(1);function i(){var t=new n.a(9);return n.a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function s(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function o(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],h=e[8],l=h*o-a*c,f=-h*s+a*u,d=c*s-o*u,y=r*l+n*f+i*d;return y?(y=1/y,t[0]=l*y,t[1]=(-h*n+i*c)*y,t[2]=(a*n-i*o)*y,t[3]=f*y,t[4]=(h*r-i*u)*y,t[5]=(-a*r+i*s)*y,t[6]=d*y,t[7]=(-c*r+n*u)*y,t[8]=(o*r-n*s)*y,t):null}function a(t){var e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],c=t[8];return e*(c*s-o*u)+r*(-c*i+o*a)+n*(u*i-s*a)}function u(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],d=r[1],y=r[2],m=r[3],p=r[4],g=r[5],b=r[6],v=r[7],_=r[8];return t[0]=f*n+d*o+y*c,t[1]=f*i+d*a+y*h,t[2]=f*s+d*u+y*l,t[3]=m*n+p*o+g*c,t[4]=m*i+p*a+g*h,t[5]=m*s+p*u+g*l,t[6]=b*n+v*o+_*c,t[7]=b*i+v*a+_*h,t[8]=b*s+v*u+_*l,t}function c(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],d=r[1];return t[0]=n,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=f*n+d*o+c,t[7]=f*i+d*a+h,t[8]=f*s+d*u+l,t}function h(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=Math.sin(r),d=Math.cos(r);return t[0]=d*n+f*o,t[1]=d*i+f*a,t[2]=d*s+f*u,t[3]=d*o-f*n,t[4]=d*a-f*i,t[5]=d*u-f*s,t[6]=c,t[7]=h,t[8]=l,t}function l(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function f(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r+r,a=n+n,u=i+i,c=r*o,h=n*o,l=n*a,f=i*o,d=i*a,y=i*u,m=s*o,p=s*a,g=s*u;return t[0]=1-l-y,t[3]=h-g,t[6]=f+p,t[1]=h+g,t[4]=1-c-y,t[7]=d-m,t[2]=f-p,t[5]=d+m,t[8]=1-c-l,t}},function(t,e,r){"use strict";function n(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}r.d(e,"a",(function(){return n}))},function(t,e,r){"use strict";function n(t,e,r){var n=e[0],i=e[1],s=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/s,t[1]=(r[1]*n+r[5]*i)/s,t}function i(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[3]*n+r[7]*i+r[11]*s||1;return t[0]=(r[0]*n+r[4]*i+r[8]*s)/o,t[1]=(r[1]*n+r[5]*i+r[9]*s)/o,t[2]=(r[2]*n+r[6]*i+r[10]*s)/o,t}function s(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2],t}function o(t,e,r){var n=e[0],i=e[1],s=e[2];return t[0]=r[0]*n+r[3]*i+r[6]*s,t[1]=r[1]*n+r[4]*i+r[7]*s,t[2]=r[2]*n+r[5]*i+r[8]*s,t[3]=e[3],t}r.d(e,"a",(function(){return n})),r.d(e,"c",(function(){return i})),r.d(e,"b",(function(){return s})),r.d(e,"d",(function(){return o}))},function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return o})),r.d(e,"d",(function(){return a}));var n=r(1);function i(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t}function s(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t}function o(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}function a(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}var u,c;u=new n.a(2),n.a!=Float32Array&&(u[0]=0,u[1]=0),c=u},,function(t,e,r){"use strict";function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}r.d(e,"a",(function(){return n}))},function(t,e,r){"use strict";var n=r(5),i=r(3),s=r(12),o=r(9),a=r(11),u=r(18);var c=r(25);function h(t){var e="function"==typeof Map?new Map:void 0;return(h=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return Object(c.a)(t,arguments,Object(o.a)(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Object(u.a)(n,t)})(t)}var l=r(4);r.d(e,"a",(function(){return f}));var f=function(t){function e(){return Object(n.a)(this,e),Object(s.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(a.a)(e,t),Object(i.a)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}},{key:"to",value:function(t){return t===this?this:Object(l.f)(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(l.b)}},{key:"formatString",value:function(t){for(var e="",r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+Object(l.e)(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Object(l.d)(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,r){void 0===r&&(r=e,e=t,t=this);for(var n=0;n<this.ELEMENTS;++n){var i=t[n];this[n]=i+r*(e[n]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var s=i[n],o=0;o<this.ELEMENTS;++o)this[o]+=s[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var s=i[n],o=0;o<this.ELEMENTS;++o)this[o]-=s[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(l.b.debug&&!this.validate(this))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"elements",get:function(){return this}}]),e}(h(Array))},function(t,e,r){"use strict";(function(t,n){r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return o}));const i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},s=i.global||i.self||i.window,o="object"!=typeof n||"[object process]"!==String(n)||n.browser,a=void 0!==n&&n.version&&n.version.match(/v([0-9]*)/);a&&parseFloat(a[1])}).call(this,r(24),r(30))},,function(t,e,r){"use strict";(function(t){function n(){var e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if(void 0!==t&&t.hrtime){var r=t.hrtime();e=1e3*r[0]+r[1]/1e6}else e=Date.now();return e}r.d(e,"a",(function(){return n}))}).call(this,r(30))},function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}r.d(e,"a",(function(){return n}))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(18);function i(t,e,r){return(i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);var s=new(Function.bind.apply(t,i));return r&&Object(n.a)(s,r.prototype),s}).apply(null,arguments)}},function(t,e,r){"use strict";r.d(e,"a",(function(){return l}));var n=r(5),i=r(3),s=r(12),o=r(9),a=r(11),u=r(19),c=r(2),h=r(14),l=function(t){function e(){return Object(n.a)(this,e),Object(s.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(a.a)(e,t),Object(i.a)(e,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r){var n=this[r]-t[r];e+=n*n}return Object(c.a)(e)}},{key:"dot",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return Object(c.a)(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var s=i[n],o=0;o<this.ELEMENTS;++o)this[o]*=s[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var s=i[n],o=0;o<this.ELEMENTS;++o)this[o]/=s[o];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return Object(h.a)(t>=0&&t<this.ELEMENTS,"index is out of range"),Object(c.a)(this[t])}},{key:"setComponent",value:function(t,e){return Object(h.a)(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Object(c.a)(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Object(c.a)(t)}}]),e}(u.a)},function(t,e,r){"use strict";r.d(e,"a",(function(){return l}));var n=r(5),i=r(3),s=r(12),o=r(9),a=r(11),u=r(19),c=r(2),h=r(4),l=function(t){function e(){return Object(n.a)(this,e),Object(s.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(a.a)(e,t),Object(i.a)(e,[{key:"toString",value:function(){var t="[";if(h.b.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(var n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+="]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,r){return this[e*this.RANK+t]=Object(c.a)(r),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),r=t*this.RANK,n=0;n<this.RANK;++n)e[n]=this[r+n];return e}},{key:"setColumn",value:function(t,e){for(var r=t*this.RANK,n=0;n<this.RANK;++n)this[r+n]=e[n];return this}}]),e}(u.a)},function(t,e,r){"use strict";function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,i=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,s=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}return r}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}r.d(e,"a",(function(){return n}))},,function(t,e){var r,n,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var u,c=[],h=!1,l=-1;function f(){h&&u&&(h=!1,u.length?c=u.concat(c):l=-1,c.length&&d())}function d(){if(!h){var t=a(f);h=!0;for(var e=c.length;e;){for(u=c,c=[];++l<e;)u&&u[l].run();l=-1,e=c.length}u=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function y(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new y(t,e)),1!==c.length||h||a(d)},y.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){},,,function(t,e,r){"use strict";(function(t){var n=r(0),i=r(35);r.d(e,"d",(function(){return i.a}));var s=r(36);r.d(e,"e",(function(){return s.a}));var o=r(37);r.d(e,"a",(function(){return o.a}));var a=r(38);r.d(e,"b",(function(){return a.a}));var u=r(40);r.d(e,"c",(function(){return u.a}));var c=r(4);r.d(e,"i",(function(){return c.b})),r.d(e,"l",(function(){return c.f})),r.d(e,"k",(function(){return c.d})),r.d(e,"n",(function(){return c.h})),r.d(e,"m",(function(){return c.g})),r.d(e,"j",(function(){return c.c})),r.d(e,"h",(function(){return c.a}));var h=r(39);r.d(e,"f",(function(){return h.a}));var l=r(14);r.d(e,"g",(function(){return l.a}));var f={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t};(f.global||f.self||f.window).mathgl={config:n.i}}).call(this,r(24))},function(t,e,r){"use strict";r.d(e,"a",(function(){return d}));var n=r(5),i=r(3),s=r(12),o=r(9),a=r(11),u=r(26),c=r(4),h=r(2),l=r(16),f=r(15),d=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(n.a)(this,e),t=Object(s.a)(this,Object(o.a)(e).call(this,2)),Object(c.f)(r)&&1===arguments.length?t.copy(r):(c.b.debug&&(Object(h.a)(r),Object(h.a)(i)),t[0]=r,t[1]=i),t}return Object(a.a)(e,t),Object(i.a)(e,[{key:"set",value:function(t,e,r){return this[0]=t,this[1]=e,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this.check()}},{key:"fromObject",value:function(t){return c.b.debug&&(Object(h.a)(t.x),Object(h.a)(t.y)),this[0]=t.x,this[1]=t.y,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return l.d(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return Object(f.a)(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return l.c(this,this,t),this.check()}},{key:"transformByMatrix2x3",value:function(t){return l.b(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return l.a(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 2}}]),e}(u.a)},function(t,e,r){"use strict";r.d(e,"a",(function(){return y}));var n=r(5),i=r(3),s=r(12),o=r(9),a=r(11),u=r(26),c=r(4),h=r(2),l=r(6),f=r(15),d=[0,0,0],y=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(n.a)(this,e),t=Object(s.a)(this,Object(o.a)(e).call(this,-0,-0,-0)),1===arguments.length&&Object(c.f)(r)?t.copy(r):(c.b.debug&&(Object(h.a)(r),Object(h.a)(i),Object(h.a)(a)),t[0]=r,t[1]=i,t[2]=a),t}return Object(a.a)(e,t),Object(i.a)(e,[{key:"set",value:function(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return c.b.debug&&(Object(h.a)(t.x),Object(h.a)(t.y),Object(h.a)(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return l.a(this,t)}},{key:"cross",value:function(t){return l.c(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,r=t.origin,n=void 0===r?d:r;return l.i(this,this,n,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,r=t.origin,n=void 0===r?d:r;return l.j(this,this,n,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,r=t.origin,n=void 0===r?d:r;return l.k(this,this,n,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return l.m(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return Object(f.c)(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return l.l(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return Object(f.b)(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return l.n(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Object(h.a)(t)}}]),e}(u.a)},function(t,e,r){"use strict";r.d(e,"a",(function(){return b}));var n=r(5),i=r(12),s=r(9),o=r(3),a=r(11),u=r(27),c=r(2),h=r(15),l=r(13),f=r(16),d=r(6),y=Object.freeze([1,0,0,0,1,0,0,0,1]),m=Object.freeze([0,0,0,0,0,0,0,0,0]),p=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),g={},b=function(t){function e(t){var r;return Object(n.a)(this,e),r=Object(i.a)(this,Object(s.a)(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return Object(a.a)(e,t),Object(o.a)(e,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return p}}],[{key:"IDENTITY",get:function(){return g.IDENTITY=g.IDENTITY||Object.freeze(new e(y)),g.IDENTITY}},{key:"ZERO",get:function(){return g.ZERO=g.ZERO||Object.freeze(new e(m)),g.ZERO}}]),Object(o.a)(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}},{key:"set",value:function(t,e,r,n,i,s,o,a,u){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=s,this[6]=o,this[7]=a,this[8]=u,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,s,o,a,u){return this[0]=t,this[1]=n,this[2]=o,this[3]=e,this[4]=i,this[5]=a,this[6]=r,this[7]=s,this[8]=u,this.check()}},{key:"determinant",value:function(){return l.b(this)}},{key:"identity",value:function(){return this.copy(y)}},{key:"fromQuaternion",value:function(t){return l.c(this,t),this.check()}},{key:"transpose",value:function(){return l.i(this,this),this.check()}},{key:"invert",value:function(){return l.d(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return l.e(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return l.e(this,this,t),this.check()}},{key:"rotate",value:function(t){return l.f(this,this,t),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?l.g(this,this,t):l.g(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return l.h(this,this,t),this.check()}},{key:"transform",value:function(t,e){switch(t.length){case 2:e=f.c(e||[-0,-0],t,this);break;case 3:e=d.l(e||[-0,-0,-0],t,this);break;case 4:e=Object(h.d)(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Object(c.b)(e,t.length),e}},{key:"transformVector",value:function(t,e){return Object(c.c)("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector2",value:function(t,e){return Object(c.c)("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector3",value:function(t,e){return Object(c.c)("Matrix3.transformVector"),this.transform(t,e)}}]),e}(u.a)},function(t,e,r){"use strict";r.d(e,"a",(function(){return _}));var n=r(28),i=r(5),s=r(12),o=r(9),a=r(3),u=r(11),c=r(2),h=r(27),l=r(15),f=r(8),d=r(16),y=r(6),m=r(10),p=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),g=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),b=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),v={},_=function(t){function e(t){var r;return Object(i.a)(this,e),r=Object(s.a)(this,Object(o.a)(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return Object(u.a)(e,t),Object(a.a)(e,[{key:"INDICES",get:function(){return b}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return v.IDENTITY=v.IDENTITY||Object.freeze(new e(p)),v.IDENTITY}},{key:"ZERO",get:function(){return v.ZERO=v.ZERO||Object.freeze(new e(g)),v.ZERO}}]),Object(a.a)(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,r,n,i,s,o,a,u,c,h,l,f,d,y,m){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=s,this[6]=o,this[7]=a,this[8]=u,this[9]=c,this[10]=h,this[11]=l,this[12]=f,this[13]=d,this[14]=y,this[15]=m,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,s,o,a,u,c,h,l,f,d,y,m){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=s,this[6]=c,this[7]=d,this[8]=r,this[9]=o,this[10]=h,this[11]=y,this[12]=n,this[13]=a,this[14]=l,this[15]=m,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(p)}},{key:"fromQuaternion",value:function(t){return f.b(this,t),this.check()}},{key:"frustum",value:function(t){var r=t.left,n=t.right,i=t.bottom,s=t.top,o=t.near,a=t.far;return a===1/0?e._computeInfinitePerspectiveOffCenter(this,r,n,i,s,o):f.c(this,r,n,i,s,o,a),this.check()}},{key:"lookAt",value:function(t,e,r){if(1===arguments.length){var n=t;t=n.eye,e=n.center,r=n.up}return e=e||[0,0,0],r=r||[0,1,0],f.f(this,t,e,r),this.check()}},{key:"ortho",value:function(t){var e=t.left,r=t.right,n=t.bottom,i=t.top,s=t.near,o=void 0===s?.1:s,a=t.far,u=void 0===a?500:a;return f.h(this,e,r,n,i,o,u),this.check()}},{key:"orthographic",value:function(t){var r=t.fovy,n=void 0===r?45*Math.PI/180:r,i=t.aspect,s=void 0===i?1:i,o=t.focalDistance,a=void 0===o?1:o,u=t.near,c=void 0===u?.1:u,h=t.far,l=void 0===h?500:h;if(n>2*Math.PI)throw Error("radians");var f=n/2,d=a*Math.tan(f),y=d*s;return(new e).ortho({left:-y,right:y,bottom:-d,top:d,near:c,far:l})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,r=t.fov,n=void 0===r?45*Math.PI/180:r,i=t.aspect,s=void 0===i?1:i,o=t.near,a=void 0===o?.1:o,u=t.far,c=void 0===u?500:u;if((e=e||n)>2*Math.PI)throw Error("radians");return f.i(this,e,s,a,c),this.check()}},{key:"determinant",value:function(){return f.a(this)}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],s=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*i,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*i,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],s=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*s,t[3]=this[4]*n,t[4]=this[5]*i,t[5]=this[6]*s,t[6]=this[8]*n,t[7]=this[9]*i,t[8]=this[10]*s,t}},{key:"transpose",value:function(){return f.p(this,this),this.check()}},{key:"invert",value:function(){return f.e(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return f.g(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return f.g(this,this,t),this.check()}},{key:"rotateX",value:function(t){return f.k(this,this,t),this.check()}},{key:"rotateY",value:function(t){return f.l(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return f.m(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=Object(n.a)(t,3),r=e[0],i=e[1],s=e[2];return this.rotateX(r).rotateY(i).rotateZ(s)}},{key:"rotateAxis",value:function(t,e){return f.j(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?f.n(this,this,t):f.n(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return f.o(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(e=m.n(e||[-0,-0,-0,-0],t,this),Object(c.b)(e,4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=d.d(e||[-0,-0],t,this);break;case 3:e=y.m(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Object(c.b)(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=Object(l.a)(e||[-0,-0],t,this);break;case 3:e=Object(l.c)(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Object(c.b)(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,r){return this.identity().translate([t,e,r])}},{key:"transformPoint",value:function(t,e){return Object(c.c)("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return Object(c.c)("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return Object(c.c)("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,r,n,i,s){var o=2*s/(r-e),a=2*s/(i-n),u=(r+e)/(r-e),c=(i+n)/(i-n),h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=u,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}}]),e}(h.a)},function(t,e,r){"use strict";e.a={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:2*Math.PI}},function(t,e,r){"use strict";var n=r(5),i=r(3),s=r(12),o=r(9),a=r(11),u=r(19),c=r(2),h=r(14),l=r(1),f=r(13),d=r(6),y=r(10);function m(){var t=new l.a(4);return l.a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function p(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function g(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=r[0],u=r[1],c=r[2],h=r[3];return t[0]=n*h+o*a+i*c-s*u,t[1]=i*h+o*u+s*a-n*c,t[2]=s*h+o*c+n*u-i*a,t[3]=o*h-n*a-i*u-s*c,t}function b(t,e,r,n){var i,s,o,a,u,c=e[0],h=e[1],f=e[2],d=e[3],y=r[0],m=r[1],p=r[2],g=r[3];return(s=c*y+h*m+f*p+d*g)<0&&(s=-s,y=-y,m=-m,p=-p,g=-g),1-s>l.b?(i=Math.acos(s),o=Math.sin(i),a=Math.sin((1-n)*i)/o,u=Math.sin(n*i)/o):(a=1-n,u=n),t[0]=a*c+u*y,t[1]=a*h+u*m,t[2]=a*f+u*p,t[3]=a*d+u*g,t}function v(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*s+o]-e[3*o+s])*r,t[s]=(e[3*s+i]+e[3*i+s])*r,t[o]=(e[3*o+i]+e[3*i+o])*r}return t}y.b,y.g,y.c,y.l;var _,w,T,O,E,S,A=y.a,k=y.k,x=y.d,N=y.i,M=y.h,I=y.m,j=y.j,R=(y.f,y.e,_=d.b(),w=d.e(1,0,0),T=d.e(0,1,0),function(t,e,r){var n=d.d(e,r);return n<-.999999?(d.c(_,w,e),d.f(_)<1e-6&&d.c(_,T,e),d.h(_,_),p(t,_,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(d.c(_,e,r),t[0]=_[0],t[1]=_[1],t[2]=_[2],t[3]=1+n,j(t,t))});O=m(),E=m(),S=f.a();r.d(e,"a",(function(){return P}));var C=[0,0,0,1],P=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(n.a)(this,e),t=Object(s.a)(this,Object(o.a)(e).call(this,-0,-0,-0,-0)),Array.isArray(r)&&1===arguments.length?t.copy(r):t.set(r,i,a,u),t}return Object(a.a)(e,t),Object(i.a)(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"set",value:function(t,e,r,n){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this.check()}},{key:"fromMatrix3",value:function(t){return v(this,t),this.check()}},{key:"identity",value:function(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.check()}},{key:"fromAxisRotation",value:function(t,e){return p(this,t,e),this.check()}},{key:"setAxisAngle",value:function(t,e){return this.fromAxisRotation(t,e)}},{key:"len",value:function(){return M(this)}},{key:"lengthSquared",value:function(t){return I(this)}},{key:"dot",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return x(this,t)}},{key:"rotationTo",value:function(t,e){return R(this,t,e),this.check()}},{key:"add",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return A(this,this,t),this.check()}},{key:"calculateW",value:function(){var t,e,r,n,i;return t=this,r=(e=this)[0],n=e[1],i=e[2],t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),this.check()}},{key:"conjugate",value:function(){var t,e;return e=this,(t=this)[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],this.check()}},{key:"invert",value:function(){var t,e,r,n,i,s,o,a;return t=this,r=(e=this)[0],n=e[1],i=e[2],s=e[3],a=(o=r*r+n*n+i*i+s*s)?1/o:0,t[0]=-r*a,t[1]=-n*a,t[2]=-i*a,t[3]=s*a,this.check()}},{key:"lerp",value:function(t,e,r){return N(this,t,e,r),this.check()}},{key:"multiplyRight",value:function(t,e){return Object(h.a)(!e),g(this,this,t),this.check()}},{key:"multiplyLeft",value:function(t,e){return Object(h.a)(!e),g(this,t,this),this.check()}},{key:"normalize",value:function(){var t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}},{key:"rotateX",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),u=Math.cos(r);t[0]=n*u+o*a,t[1]=i*u+s*a,t[2]=s*u-i*a,t[3]=o*u-n*a}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),u=Math.cos(r);t[0]=n*u-s*a,t[1]=i*u+o*a,t[2]=s*u+n*a,t[3]=o*u-i*a}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),u=Math.cos(r);t[0]=n*u+i*a,t[1]=i*u-n*a,t[2]=s*u+o*a,t[3]=o*u-s*a}(this,this,t),this.check()}},{key:"scale",value:function(t){return k(this,this,t),this.check()}},{key:"slerp",value:function(t,e,r){switch(arguments.length){case 1:var n=arguments[0],i=n.start;t=void 0===i?C:i,e=n.target,r=n.ratio;break;case 2:var s=Array.prototype.slice.call(arguments);e=s[0],r=s[1],t=this}return b(this,t,e,r),this.check()}},{key:"transformVector4",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return y.o(e,t,this),Object(c.b)(e,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(t,e){return this.setAxisAngle(t,e)}},{key:"premultiply",value:function(t,e){return this.multiplyLeft(t,e)}},{key:"multiply",value:function(t,e){return this.multiplyRight(t,e)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Object(c.a)(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Object(c.a)(t)}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Object(c.a)(t)}},{key:"w",get:function(){return this[3]},set:function(t){return this[3]=Object(c.a)(t)}}]),e}(u.a)},,,,,,function(t,e,r){(function(e){const n=r(57),i="undefined"==typeof window?e:window;i.loaders=i.loaders||{},t.exports=Object.assign(i.loaders,n)}).call(this,r(24))},,,,,,,,,,,function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"decode",(function(){return Dt})),r.d(n,"encode",(function(){return Ut}));var i={};r.r(i),r.d(i,"decode",(function(){return qt})),r.d(i,"encode",(function(){return Ft}));var s={};r.r(s),r.d(s,"decode",(function(){return zt})),r.d(s,"encode",(function(){return Gt}));var o={};r.r(o),r.d(o,"dirname",(function(){return ur}));var a={id:"3d-tileset",name:"3D Tileset",extensions:["json"],parse:async t=>JSON.parse((new TextDecoder).decode(t)),parseTextSync:JSON.parse,testText:t=>t.indexOf(!1)};const u={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect"},c=(Object.keys(u),{BATCHED_MODEL:[98,51,100,109],INSTANCED_MODEL:[105,51,100,109],POINT_CLOUD:[112,110,116,115],COMPOSITE:[99,109,112,116]}),h={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},l={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0},f={ADD:0,REPLACE:1};function d(t,e){if(!t)throw new Error(e||"loader assertion failed.")}function y(t,e,r){d(t instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(t,e,r);return n.decode(i)}var m=r(0);const p={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},g={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...p},b={[p.DOUBLE]:Float64Array,[p.FLOAT]:Float32Array,[p.UNSIGNED_SHORT]:Uint16Array,[p.UNSIGNED_INT]:Uint32Array,[p.UNSIGNED_BYTE]:Uint8Array,[p.BYTE]:Int8Array,[p.SHORT]:Int16Array,[p.INT]:Int32Array},v={DOUBLE:p.DOUBLE,FLOAT:p.FLOAT,UNSIGNED_SHORT:p.UNSIGNED_SHORT,UNSIGNED_INT:p.UNSIGNED_INT,UNSIGNED_BYTE:p.UNSIGNED_BYTE,BYTE:p.BYTE,SHORT:p.SHORT,INT:p.INT},_="Failed to convert GL type";class w{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in b){if(b[e]===t)return e}throw new Error(_)}static fromName(t){const e=v[t];if(!e)throw new Error(_);return e}static getArrayType(t,e=!1){switch(t){case p.UNSIGNED_SHORT_5_6_5:case p.UNSIGNED_SHORT_4_4_4_4:case p.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=b[t];if(!e)throw new Error(_);return e}}static getByteSize(t){return w.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return Boolean(w.getArrayType(t))}static createTypedArray(t,e,r=0,n){return void 0===n&&(n=(e.byteLength-r)/w.getByteSize(t)),new(w.getArrayType(t))(e,r,n)}}class T{constructor(t,e){this.json=t,this.buffer=e,this.featuresLength=0,this._cachedTypedArrays={}}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return Boolean(this.json[t])}getGlobalProperty(t,e=g.UNSIGNED_INT,r=1){const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(t,e,r,1,n.byteOffset):n}getPropertyArray(t,e,r){const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(e=w.fromName(n.componentType)),this._getTypedArrayFromBinary(t,e,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(t,e,n)}getProperty(t,e,r,n,i){const s=this.json[t];if(!s)return s;const o=this.getPropertyArray(t,e,r);if(1===r)return o[n];for(let t=0;t<r;++t)i[t]=o[r*n+t];return i}_getTypedArrayFromBinary(t,e,r,n,i){const s=this._cachedTypedArrays;let o=s[t];return o||(o=w.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+i,n*r),s[t]=o),o}_getTypedArrayFromArray(t,e,r){const n=this._cachedTypedArrays;let i=n[t];return i||(i=w.createTypedArray(e,r),n[t]=i),i}}function O(t,e){if(!t)throw new Error(e||"3d-tile loader: assertion failed.")}const E={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},S={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},A={SCALAR:(t,e,r)=>{e[r]=t},VEC2:(t,e,r)=>{e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:(t,e,r)=>{e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:(t,e,r)=>{e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:(t,e,r)=>{e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}};const k=t=>void 0!==t;function x(t,e,r){if(!e)return null;let n=t.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?function(t,e){let r,n,i;const s=t.instancesLength,o=t.classes,a=t.classIds,u=t.parentCounts,c=t.parentIds,h=s;k(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,i=getBinaryAccessor(a),a=i.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,s));let l;if(k(u))for(k(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,s)),l=new Uint16Array(s),h=0,r=0;r<s;++r)l[r]=h,h+=u[r];k(c)&&k(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,h));const f=o.length;for(r=0;r<f;++r){const t=o[r].length,n=o[r].instances,i=getBinaryProperties(t,n,e);o[r].instances=combine(i,n)}const d=new Array(f).fill(0),y=new Uint16Array(s);for(r=0;r<s;++r)n=a[r],y[r]=d[n],++d[n];const m={classes:o,classIds:a,classIndexes:y,parentCounts:u,parentIndexes:l,parentIds:c};return function(t){const e=t.classIds.length;for(let r=0;r<e;++r)M(t,r,stack)}(m),m}(n,r):null}function N(t,e,r){if(!t)return;const n=t.parentCounts;return t.parentIds?r(t,e):n>0?function(t,e,r){const n=t.classIds,i=t.parentCounts,s=t.parentIds,o=t.parentIndexes,a=n.length,u=scratchVisited;u.length=Math.max(u.length,a);const c=++marker,h=scratchStack;h.length=0,h.push(e);for(;h.length>0;){if(e=h.pop(),u[e]===c)continue;u[e]=c;const n=r(t,e);if(k(n))return n;const a=i[e],l=o[e];for(let t=0;t<a;++t){const r=s[l+t];r!==e&&h.push(r)}}return null}(t,e,r):function(t,e,r){let n=!0;for(;n;){const i=r(t,e);if(k(i))return i;const s=t.parentIds[e];n=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}(t,e,r)}function M(t,e,r){const n=t.parentCounts,i=t.parentIds,s=t.parentIndexes,o=t.classIds.length;if(!k(i))return;assert(e<o,`Parent index ${e} exceeds the total number of instances: ${o}`),assert(-1===r.indexOf(e),"Circular dependency detected in the batch table hierarchy."),r.push(e);const a=k(n)?n[e]:1,u=k(n)?s[e]:e;for(let n=0;n<a;++n){const s=i[u+n];s!==e&&M(t,s,r)}r.pop(e)}const I=t=>void 0!==t,j=t=>t,R={HIERARCHY:!0,extensions:!0,extras:!0};class C{constructor(t,e,r,n={}){O(r>=0),this.json=t||{},this.binary=e,this.featureCount=r,this._extensions=this.json&&this.json.extensions||{},this._properties={};for(const t in this.json)R[t]||(this._properties[t]=this.json[t]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=x(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),O("string"==typeof e,e),this._hierarchy){const r=N(this._hierarchy,t,(t,r)=>{const n=t.classIds[r];return t.classes[n].name===e});return I(r)}return!1}isExactClass(t,e){return O("string"==typeof e,e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),O("string"==typeof e,e),I(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),(e=I(e)?e:[]).length=0;const r=Object.keys(this._properties);return e.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),O("string"==typeof e,e),this._binaryProperties){const r=this._binaryProperties[e];if(I(r))return this._getBinaryProperty(r,t)}const r=this._properties[e];if(I(r))return j(r[t],!0);if(this._hierarchy){const r=this._getHierarchyProperty(t,e);if(I(r))return r}}setProperty(t,e,r){const n=this.featureCount;if(this._checkBatchId(t,n),O("string"==typeof e,e),this._binaryProperties){const n=this._binaryProperties[e];if(n)return void this._setBinaryProperty(n,t,r)}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,r))return;let i=this._properties[e];I(i)||(this._properties[e]=new Array(n),i=this._properties[e]),i[t]=j(r,!0)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,r){t.pack(r,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const r=this._properties[e],n=this._initializeBinaryProperty(e,r);n&&(t=t||{},t[e]=n)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const r=e;O(this.binary,`Property ${t} requires a batch table binary.`),O(r.type,`Property ${t} requires a type.`);const n=function(t,e,r,n){const{componentType:i}=t;d(t.componentType);const s="string"==typeof i?w.fromName(i):i,o=E[t.type],a=S[t.type],u=A[t.type];return r+=t.byteOffset,{values:w.createTypedArray(s,e,r,o*n),type:s,size:o,unpacker:a,packer:u}}(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const r=N(this._hierarchy,t,(t,r)=>{const n=t.classIds[r],i=t.classes[n].instances;return I(i[e])});return I(r)}_getPropertyNamesInHierarchy(t,e){N(this._hierarchy,t,(t,r)=>{const n=t.classIds[r],i=t.classes[n].instances;for(const t in i)i.hasOwnProperty(t)&&-1===e.indexOf(t)&&e.push(t)})}_getHierarchyProperty(t,e){return N(this._hierarchy,t,(t,r)=>{const n=t.classIds[r],i=t.classes[n],s=t.classIndexes[r],o=i.instances[e];return I(o)?I(o.typedArray)?this._getBinaryProperty(o,s):j(o[s],!0):null})}_setHierarchyProperty(t,e,r,n){const i=N(this._hierarchy,e,(t,i)=>{const s=t.classIds[i],o=t.classes[s],a=t.classIndexes[i],u=o.instances[r];return!!I(u)&&(O(i===e,`Inherited property "${r}" is read-only.`),I(u.typedArray)?this._setBinaryProperty(u,a,n):u[a]=j(n,!0),!0)});return I(i)}}const P=4;function L(t,e,r=0){const n=new DataView(e);if(t.magic=n.getUint32(r,!0),r+=P,t.version=n.getUint32(r,!0),r+=P,t.byteLength=n.getUint32(r,!0),r+=P,1!==t.version)throw new Error(`3D Tile Version ${t.version} not supported`);return r}const D=4;function U(t,e,r){const n=new DataView(e);return t.header=t.header||{},t.header.featureTableJsonByteLength=n.getUint32(r,!0),r+=D,t.header.featureTableBinaryByteLength=n.getUint32(r,!0),r+=D,t.header.batchTableJsonByteLength=n.getUint32(r,!0),r+=D,t.header.batchTableBinaryByteLength=n.getUint32(r,!0),r+=D}function B(t,e,r,n){return r=function(t,e,r,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s}=t.header;if(t.featureTableJson={BATCH_LENGTH:0},i>0){const n=y(e,r,i);t.featureTableJson=JSON.parse(n)}return r+=i,t.featureTableBinary=new Uint8Array(e,r,s),r+=s}(t,e,r),r=function(t,e,r,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=t.header;if(i>0){const n=y(e,r,i);t.batchTableJson=JSON.parse(n),r+=i,s>0&&(t.batchTableBinary=new Uint8Array(e,r,s),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=s)}return r}(t,e,r)}function V(t,e=[0,0,0]){const r=t>>11&31,n=t>>5&63,i=31&t;return e[0]=r<<3,e[1]=n<<2,e[2]=i<<3,e}function q(t,e,r){if(!(e||t&&t.batchIds&&r))return null;const{batchIds:n,isRGB565:i,pointCount:s}=t;if(n&&r){const t=new Uint8ClampedArray(3*s);for(let e=0;e<s;e++){const i=n[e],s=r.getProperty(i,"dimensions").map(t=>255*t);t[3*e]=s[0],t[3*e+1]=s[1],t[3*e+2]=s[2]}return{type:g.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}if(i){const t=new Uint8ClampedArray(3*s);for(let r=0;r<s;r++){const n=V(e[r]);t[3*r]=n[0],t[3*r+1]=n[1],t[3*r+2]=n[2]}return{type:g.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}return e&&e.length===3*s?{type:g.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:g.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}function F(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}new m.d,new m.e,new m.d,new m.d,new Uint8Array(1);function z(t,e=255){return Object(m.h)(t,0,e)/e*2-1}function G(t){return t<0?-1:1}function $(t,e,r,n){if(F(n),t<0||t>r||e<0||e>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(n.x=z(t,r),n.y=z(e,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const t=n.x;n.x=(1-Math.abs(n.y))*G(t),n.y=(1-Math.abs(t))*G(n.y)}return n.normalize()}function H(t,e,r){return $(t,e,255,r)}const W=new m.e;function Q(t,e,r){return t.isQuantized?r.decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){const r=new m.e,n=new Float32Array(3*t.pointCount);for(let i=0;i<t.pointCount;i++)r.set(e[3*i],e[3*i+1],e[3*i+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(n,3*i);return n}(t,e)):{type:g.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}async function Y(t,e,r,n,i){r=B(t,e,r=U(t,e,r=L(t,e,r))),function(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}(t);const{featureTable:s,batchTable:o}=function(t){const e=new T(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",g.FLOAT,3);const n=function(t,e){let r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",g.UNSIGNED_SHORT,1),t.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=t;r=new C(i,s,n)}return r}(t,e);return{featureTable:e,batchTable:n}}(t);return await async function(t,e,r,n,i){let s,o,a;const u=r&&r.getExtension("3DTILES_draco_point_compression");u&&(a=u.properties);const c=e.getExtension("3DTILES_draco_point_compression");if(c){o=c.properties;const e=c.byteOffset,r=c.byteLength;if(!o||!Number.isFinite(e)||!r)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=t.featureTableBinary.slice(e,e+r),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const h={buffer:s,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await async function(t,e,r,n){const{parse:i}=n,s=await i(e.buffer,{}),o=s.attributes.POSITION&&s.attributes.POSITION.value,a=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,u=s.attributes.NORMAL&&s.attributes.NORMAL.value,c=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,h=o&&s.attributes.POSITION.value.quantization,l=u&&s.attributes.NORMAL.value.quantization;if(h){const e=s.POSITION.data.quantization,r=e.range;t.quantizedVolumeScale=new m.e(r,r,r),t.quantizedVolumeOffset=new m.e(e.minValues),t.quantizedRange=(1<<e.quantizationBits)-1,t.isQuantizedDraco=!0}l&&(t.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);t.attributes={positions:o,colors:q(t,a),normals:u,batchIds:c}}(t,h,0,i)}(t,s,o,0,i),function(t,e,r){if(!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",g.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",g.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",g.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",g.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=Q(t,n,r)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(t,s,n),function(t,e,r){if(!t.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",g.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",g.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",g.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=q(t,n,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",g.UNSIGNED_BYTE,4))}(t,s,o),function(t,e){if(!t.attributes.normals){let r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",g.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",g.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){const r=new Float32Array(3*t.pointsLength);for(let n=0;n<t.pointsLength;n++)H(e[2*n],e[2*n+1],W),W.toArray(r,3*n);return{type:g.FLOAT,size:2,value:r}}return{type:g.FLOAT,size:2,value:e}}(t,r)}}(t,s),r}function Z(t,e){if(!t)throw new Error(e)}var K=r(20);const J="undefined"!=typeof ImageBitmap,X="undefined"!=typeof Image,tt=Boolean(K.a._parseImageNode);function et(t){switch(t){case"auto":return!0;case"imagebitmap":return J;case"html":return X;case"ndarray":return tt;default:throw new Error(`Unknown image format ${t}`)}}function rt(t={}){const e=(t.image||{}).type||"auto";switch(e){case"imagebitmap":case"html":case"ndarray":if(!et(e))throw new Error(`Requested image type ${e} not available in current environment`);return e;case"auto":return function(){if(et("ndarray"))return"ndarray";if(et("html"))return"html";if(et("imagebitmap"))return"imagebitmap";if(!K.b)throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js");return Z(!1)}();default:throw new Error(`Unknown image format ${e}`)}}const nt=!1,it=!0,st=new Map([["image/png",{test:ot,getSize:function(t){return{width:t.getUint32(16,nt),height:t.getUint32(20,nt)}}}],["image/jpeg",{test:ct,getSize:function(t){if(t.byteLength<2||65496!==t.getUint16(0,nt))return null;const{tableMarkers:e,sofMarkers:r}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);const e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}();let n=2;for(;n<t.byteLength;){const i=t.getUint16(n,nt);if(r.has(i))return{height:t.getUint16(n+5,nt),width:t.getUint16(n+7,nt)};if(!e.has(i))return null;n+=2,n+=t.getUint16(n,nt)}return null}}],["image/gif",{test:at,getSize:function(t){return{width:t.getUint16(6,it),height:t.getUint16(8,it)}}}],["image/bmp",{test:ut,getSize:function(t){return{width:t.getUint32(18,it),height:t.getUint32(22,it)}}}]]);function ot(t){return t.byteLength>=24&&2303741511===t.getUint32(0,nt)}function at(t){return t.byteLength>=10&&1195984440===t.getUint32(0,nt)}function ut(t){return t.byteLength>=2&&16973===t.getUint16(0,nt)}function ct(t){return t.byteLength>=3&&65496===t.getUint16(0,nt)&&255===t.getUint8(2,nt)}Array.from(st.keys()).join(", ");function ht(t){const e=lt(t);for(const[t,{test:r}]of st.entries())if(r(e))return t;return null}function lt(t){if((t=t.buffer||t)instanceof ArrayBuffer||ArrayBuffer.isView(t))return new DataView(t.buffer||t);throw new Error("toDataView")}async function ft(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((e,n)=>{try{r.onload=()=>e(r),r.onerror=e=>n(new Error(`Could not load image ${t}: ${e}`))}catch(t){n(t)}})}const dt=/^data:image\/svg\+xml/,yt=/\.svg((\?|#).*)?$/;var mt={name:"Images",version:"2.0.4",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vndmicrosofticon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(t,e,r){e=e||{};const{url:n}=r||{};if(n&&(dt.test(n)||yt.test(n)))return await async function(t,e){const r=(new TextDecoder).decode(t),n=`data:image/svg+xml;base64,${btoa(r)}`;return await ft(n,e)}(t,e);switch(rt(e)){case"imagebitmap":return await function(t,e){const r=new Blob([new Uint8Array(t)]),n=e&&e.imagebitmap;return n?createImageBitmap(r):createImageBitmap(r,n)}(t,e);case"html":return await async function(t,e){const r=new Blob([t],{type:"image/jpeg"}),n=self.URL||self.webkitURL,i=n.createObjectURL(r);try{return await ft(i,e)}finally{n.revokeObjectURL(i)}}(t,e);case"ndarray":return await function(t,e){Z(K.a._parseImageNode);const r=ht(t);return K.a._parseImageNode(t,r,e)}(t,e);default:return Z(!1)}},test:t=>{const e=new DataView(t);return ct(e)||ut(e)||at(e)||ot(e)},options:{image:{format:"auto",decodeHTML:!0}}};function pt(t,e,r){if(t.byteLength<=e+r)return"";const n=new DataView(t);let i="";for(let t=0;t<r;t++)i+=String.fromCharCode(n.getUint8(e+t));return i}function gt(t){try{return JSON.parse(t)}catch(e){throw new Error(`Failed to parse JSON from data starting with "${function(t,e=5){if("string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return pt(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){return pt(t,0,e)}return""}(t)}"`)}}function bt(t){return t+3&-4}function vt(t,e,r){const n=r?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(n).buffer}function _t(t,e,r){let n;if(t instanceof ArrayBuffer)n=new Uint8Array(t);else{const e=t.byteOffset,r=t.byteLength;n=new Uint8Array(t.buffer,e,r)}return e.set(n,r),r+bt(n.byteLength)}function wt(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function Tt(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}function Ot(t,e,r){const n=t.bufferViews[r];wt(n);const i=e[n.buffer];wt(i);const s=(n.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,s,n.byteLength)}const Et=["SCALAR","VEC2","VEC3","VEC4"],St=new Map([[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126]]),At={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},kt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},xt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Nt(t){return Et[t-1]||Et[0]}function Mt(t){const e=St.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function It(t,e){const r=xt[t.componentType],n=At[t.type],i=kt[t.componentType],s=t.count*n,o=t.count*n*i;return wt(o>=0&&o<=e.byteLength),{ArrayType:r,length:s,byteLength:o}}class jt{constructor(t){if(t instanceof jt)return t;t||(t={json:{version:2,buffers:[]},buffers:[]}),this.gltf=t,wt(this.gltf.json)}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find(e=>e===t),r=this.json.extensions||{};return e?r[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getCamera(t){return null}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if("object"==typeof e)return e;const r=this.json[t]&&this.json[t][e];if(!r)throw new Error(`glTF file error: Could not find ${t}[${e}]`);return r}getTypedArrayForBufferView(t){const e=(t=this.getBufferView(t)).buffer,r=this.gltf.buffers[e];wt(r);const n=(t.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,{ArrayType:n,length:i}=It(t,e);return new n(r,e.byteOffset+t.byteOffset,i)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,n=e.byteOffset||0;return new Uint8Array(r,n,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,r){return wt(r),t.extensions=t.extensions||{},t.extensions[e]=r,this.registerUsedExtension(e),this}removeObjectExtension(t,e){return delete(t.extensions||{})[e],this}addExtension(t,e){return wt(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),this}addRequiredExtension(t,e){return wt(e),this.addExtension(t,e),this.registerRequiredExtension(t),this}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t]}setObjectExtension(t,e,r){(t.extensions||{})[e]=r}addMesh(t,e,r=4){const n={primitives:[{attributes:this._addAttributes(t),indices:e,mode:r}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){e=e||ht(t);const r={bufferView:this.addBufferView(t),mimeType:e};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(t){const e=t.byteLength;wt(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const r={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=bt(e),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(t,e){const r={bufferView:t,type:Nt(e.size),componentType:e.componentType,count:e.count};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(t,e={size:3}){const r=this.addBufferView(t),n={size:e.size,componentType:Mt(t),count:Math.round(t.length/e.size)};return this.addAccessor(r,Object.assign(n,e))}createBinaryChunk(){if(this.arrayBuffer)return;const t=this.byteLength,e=new ArrayBuffer(t),r=new Uint8Array(e);let n=0;for(let t=0;t<this.sourceBuffers.length;t++){n=_t(this.sourceBuffers[t],r,n)}this.json.buffers[0].byteLength=t,this.arrayBuffer=e,this.sourceBuffers=[]}_removeStringFromArray(t,e){let r=!0;for(;r;){const n=t.indexOf(e);n>-1?t.splice(n,1):r=!1}}}const Rt="KHR_draco_mesh_compression",Ct="KHR_lights_punctual",Pt="KHR_materials_unlit";function Lt(t,e){const{buffer:r,size:n,count:i}=function(t,e){let r=t,n=1,i=0;t&&t.value&&(r=t.value,n=t.size||1);r&&(ArrayBuffer.isView(r)||(r=function(t,e,r=!1){if(!t)return null;if(Array.isArray(t))return new e(t);if(r&&!(t instanceof e))return new e(t);return t}(r,Float32Array)),i=r.length/n);return{buffer:r,size:n,count:i}}(t);return{value:r,size:n,bufferView:null,byteOffset:0,count:i,type:Nt(n),componentType:Mt(r)}}async function Dt(t,e,r){if(!e.gltf.decompressMeshes)return;const n=new jt(t),i=[];for(const t of function*(t){for(const e of t.json.meshes||[])for(const t of e.primitives)yield t}(n))n.getObjectExtension(t,Rt)&&i.push(Bt(t,n,e,r));await Promise.all(i),n.removeExtension(Rt)}function Ut(t,e={}){const r=new jt(t);for(const t of r.json.meshes||[])Vt(t,e),r.addRequiredExtension(Rt)}async function Bt(t,e,r,n){const i=e.getObjectExtension(t,Rt),s=e.getTypedArrayForBufferView(i.bufferView),o=vt(s.buffer,s.byteOffset),{parse:a}=n,u=await a(o,[],r,n);t.attributes=function(t){const e={};for(const r in t){const n=t[r];if("indices"!==r){const t=Lt(n);e[r]=t}}return e}(u.attributes),u.indices&&(t.indices=Lt(u.indices)),function(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("Empty glTF primitive detected: Draco decompression failure?")}(t)}function Vt(t,e,r=4,n,i){if(!n.DracoWriter||!n.DracoLoader)throw new Error("DracoWriter/DracoLoader not available");const s=n.DracoWriter.encodeSync({attributes:t}),{parseSync:o}=i,a=o({attributes:t}),u=n._addFauxAttributes(a.attributes),c=n.addBufferView(s);return{primitives:[{attributes:u,mode:r,extensions:{[Rt]:{bufferView:c,attributes:u}}}]}}function qt(t,e){const r=new jt(t),{json:n}=r,i=r.getExtension(Ct);i&&(r.json.lights=i.lights,r.removeExtension(Ct));for(const t of n.nodes||[]){const e=r.getObjectExtension(t,Ct);e&&(t.light=e.light),r.removeObjectExtension(t,Ct)}}function Ft(t,e){const r=new jt(t),{json:n}=r;if(n.lights){const t=r.addExtension(Ct);wt(!t.lights),t.lights=n.lights,delete n.lights}if(r.json.lights){for(const t of r.json.lights){const e=t.node;r.addObjectExtension(e,Ct,t)}delete r.json.lights}}function zt(t,e){const r=new jt(t),{json:n}=r;r.removeExtension(Pt);for(const t of n.materials||[]){t.extensions&&t.extensions.KHR_materials_unlit&&(t.unlit=!0),r.removeObjectExtension(t,Pt)}}function Gt(t,e){const r=new jt(t),{json:n}=r;if(r.materials)for(const t of n.materials)t.unlit&&(delete t.unlit,r.addObjectExtension(t,Pt),r.addExtension(Pt))}const $t={KHR_draco_mesh_compression:n,KHR_lights_punctual:i,KHR_materials_unlit:s};const Ht=1735152710,Wt=12,Qt=8,Yt=1313821514,Zt=5130562,Kt=0,Jt=1,Xt=!0;function te(t,e=0,r={}){const n=new DataView(t),{magic:i=Ht}=r,s=n.getUint32(e,!1);return s===i||s===Ht}function ee(t,e,r=0,n={}){const i=new DataView(e);t.type=function(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}(i,r+0),t.version=i.getUint32(r+4,Xt);const s=i.getUint32(r+8,Xt);return t.header={byteOffset:r,byteLength:s},d(2===t.version,`Invalid GLB version ${t.version}. Only supports v2.`),d(t.header.byteLength>Wt+Qt),t.json={},t.binChunks=[],function(t,e,r,n){for(;r+8<=t.header.byteLength;){const i=e.getUint32(r+0,Xt),s=e.getUint32(r+4,Xt);switch(r+=Qt,s){case Yt:re(t,e,r,i,n);break;case Zt:ne(t,e,r,i,n);break;case Kt:n.glb.strict||re(t,e,r,i,n);break;case Jt:n.glb.strict||ne(t,e,r,i,n)}r+=bt(i)}}(t,i,r+Wt,n),r+t.header.byteLength}function re(t,e,r,n,i){const s=new Uint8Array(e.buffer,r,n),o=new TextDecoder("utf8").decode(s);t.json=JSON.parse(o)}function ne(t,e,r,n,i){t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:e.buffer})}const ie={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},se={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},oe={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},ae={magFilter:oe.TEXTURE_MAG_FILTER,minFilter:oe.TEXTURE_MIN_FILTER,wrapS:oe.TEXTURE_WRAP_S,wrapT:oe.TEXTURE_WRAP_T},ue={[oe.TEXTURE_MAG_FILTER]:oe.LINEAR,[oe.TEXTURE_MIN_FILTER]:oe.NEAREST_MIPMAP_LINEAR,[oe.TEXTURE_WRAP_S]:oe.REPEAT,[oe.TEXTURE_WRAP_]:oe.REPEAT};class ce{postProcess(t,e={}){const{json:r,buffers:n=[],images:i=[],baseUri:s=""}=t;return wt(r),this.baseUri=s,this.json=r,this.buffers=n,this.images=i,this._resolveTree(this.json,e),this.json}_resolveTree(t,e={}){t.bufferViews&&(t.bufferViews=t.bufferViews.map((t,e)=>this._resolveBufferView(t,e))),t.images&&(t.images=t.images.map((t,r)=>this._resolveImage(t,r,e))),t.samplers&&(t.samplers=t.samplers.map((t,e)=>this._resolveSampler(t,e))),t.textures&&(t.textures=t.textures.map((t,e)=>this._resolveTexture(t,e))),t.accessors&&(t.accessors=t.accessors.map((t,r)=>this._resolveAccessor(t,r,e))),t.materials&&(t.materials=t.materials.map((t,e)=>this._resolveMaterial(t,e))),t.meshes&&(t.meshes=t.meshes.map((t,e)=>this._resolveMesh(t,e))),t.nodes&&(t.nodes=t.nodes.map((t,e)=>this._resolveNode(t,e))),t.skins&&(t.skins=t.skins.map((t,e)=>this._resolveSkin(t,e))),t.scenes&&(t.scenes=t.scenes.map((t,e)=>this._resolveScene(t,e))),void 0!==t.scene&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if("object"==typeof e)return e;const r=this.json[t]&&this.json[t][e];return r||console.warn(`glTF file error: Could not find ${t}[${e}]`),r}_resolveScene(t,e){return t.id=t.id||`scene-${e}`,t.nodes=(t.nodes||[]).map(t=>this.getNode(t)),t}_resolveNode(t,e){return t.id=t.id||`node-${e}`,t.children&&(t.children=t.children.map(t=>this.getNode(t))),void 0!==t.mesh&&(t.mesh=this.getMesh(t.mesh)),void 0!==t.camera&&(t.camera=this.getCamera(t.camera)),void 0!==t.skin&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||`skin-${e}`,t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||`mesh-${e}`,t.primitives&&(t.primitives=t.primitives.map(t=>{const e=(t={...t}).attributes;t.attributes={};for(const r in e)t.attributes[r]=this.getAccessor(e[r]);return void 0!==t.indices&&(t.indices=this.getAccessor(t.indices)),void 0!==t.material&&(t.material=this.getMaterial(t.material)),t})),t}_resolveMaterial(t,e){if(t.id=t.id||`material-${e}`,t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const e=t.pbrMetallicRoughness;e.baseColorTexture&&(e.baseColorTexture={...e.baseColorTexture},e.baseColorTexture.texture=this.getTexture(e.baseColorTexture.index)),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture={...e.metallicRoughnessTexture},e.metallicRoughnessTexture.texture=this.getTexture(e.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){var r,n;if(t.id=t.id||`accessor-${e}`,void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=(r=t.componentType,se[r]),t.components=(n=t.type,ie[n]),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const e=t.bufferView.buffer,{ArrayType:r,length:n}=It(t,t.bufferView),i=(t.bufferView.byteOffset||0)+e.byteOffset;t.value=new r(e.arrayBuffer,i,n)}return t}_resolveTexture(t,e){return t.id=t.id||`texture-${e}`,t.sampler="sampler"in t?this.getSampler(t.sampler):ue,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||`sampler-${e}`,t.parameters={};for(const e in t){const r=this._enumSamplerParameter(e);void 0!==r&&(t.parameters[r]=t[e])}return t}_enumSamplerParameter(t){return ae[t]}_resolveImage(t,e){t.id=t.id||`image-${e}`,void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView));const r=this.images[e];return r&&(t.image=r),t}_resolveBufferView(t,e){t.id=t.id||`bufferView-${e}`;const r=t.buffer;t.buffer=this.buffers[r];const n=this.buffers[r].arrayBuffer;let i=this.buffers[r].byteOffset||0;return"byteOffset"in t&&(i+=t.byteOffset),t.data=new Uint8Array(n,i,t.byteLength),t}_resolveCamera(t,e){return t.id=t.id||`camera-${e}`,t.perspective,t.orthographic,t}}async function he(t,e,r=0,n,i){!function(t,e,r,n){n.uri&&(t.baseUri=n.uri);if(e instanceof ArrayBuffer&&!te(e,r,n)){const t=new TextDecoder;e=t.decode(e)}if("string"==typeof e)t.json=gt(e);else if(e instanceof ArrayBuffer){const i={};r=ee(i,e,r,n),wt("glTF"===i.type,`Invalid GLB magic string ${i.type}`),t._glb=i,t.json=i.json}else wt(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:e}=t._glb;t.buffers[0]={arrayBuffer:e[0].arrayBuffer,byteOffset:e[0].byteOffset,byteLength:e[0].byteLength}}const s=t.json.images||[];t.images=new Array(s.length).fill({})}(t,e,r,n);const s=[];if(n.gltf.loadImages){const e=async function(t,e,r){const n=t.json.images||[],i=[];for(let s=0;s<n.length;++s)i.push(le(t,n[s],s,e,r));return await Promise.all(i)}(t,n,i);s.push(e)}n.gltf.loadBuffers&&await async function(t,e,r){for(let n=0;n<t.json.buffers.length;++n){const i=t.json.buffers[n];if(i.uri){const{fetch:s}=r;wt(s);const o=Tt(i.uri,e),a=await s(o),u=await a.arrayBuffer();t.buffers[n]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete i.uri}}}(t,n,i);const o=async function(t,e={},r){e.gltf=e.gltf||{};for(const n in $t){const i=e.gltf.excludeExtensions||{};if(!(n in i&&!i[n])){const i=$t[n];await i.decode(t,e,r)}}}(t,n,i);return s.push(o),await Promise.all(s),n.gltf.postProcess?function(t,e){return(new ce).postProcess(t,e)}(t,n):t}async function le(t,e,r,n,i){const{fetch:s,parse:o}=i;let a;if(e.uri){const t=Tt(e.uri,n),r=await s(t);a=await r.arrayBuffer()}if(Number.isFinite(e.bufferView)){const r=Ot(t.json,t.buffers,e.bufferView);a=vt(r.buffer,r.byteOffset,r.byteLength)}wt(a,"glTF image has no data");const u=await o(a,mt,{},i);t.images[r]=u}const fe={id:"gltf",name:"glTF",version:"2.0.4",extensions:["gltf","glb"],mimeType:"model/gltf+json",text:!0,binary:!0,test:"glTF",parse:async function(t,e={},r){(e={...fe.options,...e}).gltf={...fe.options.gltf,...e.gltf},function(t){"fetchImages"in t&&(t.gltf.loadImages=t.fetchImages);"createImages"in t&&(t.gltf.loadImages=t.createImages);"fetchLinkedResources"in t&&(t.gltf.fetchBuffers=t.fetchLinkedResources);"decompress"in t&&(t.gltf.decompressMeshes=t.decompress);"decompress"in t.gltf&&(t.gltf.decompressMeshes=t.gltf.decompress);"postProcess"in t&&(t.gltf.postProcess=t.postProcess)}(e);const{byteOffset:n=0}=e;return await he({},t,n,e,r)},options:{gltf:{loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},uri:"",log:console}};var de=fe;const ye={URI:0,EMBEDDED:1};function me(t,e,r){t.rotateYtoZ=!0;const n=t.byteOffset+t.byteLength-r;if(0===n)throw new Error("glTF byte length must be greater than 0.");return t.gltfArrayBuffer=vt(e,r,n),t.gltfByteOffset=0,t.gltfByteLength=n,r%4==0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),t.byteOffset+t.byteLength}async function pe(t,e,r,n){if(ge(t,e,r),r.loadGLTF){const{parse:e,fetch:i}=n;t.gltfUrl&&(t.gltfArrayBuffer=await i(t.gltfUrl,r),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await e(t.gltfArrayBuffer,de,r,n),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}function ge(t,e,r){switch(e){case ye.URI:const e=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),r=(new TextDecoder).decode(e);t.gltfUrl=r.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case ye.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function be(t,e,r,n,i){r=function(t,e,r,n,i){r=L(t,e,r),r=U(t,e,r),r=B(t,e,r),r=me(t,e,r);const s=new T(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=s.getGlobalProperty("RTC_CENTER",g.FLOAT,3),r}(t,e,r),await pe(t,ye.EMBEDDED,n,i);const{extensions:s}=t.gltf||{};return s&&s.CESIUM_RTC&&(t.rtcCenter=s.CESIUM_RTC.center),r}var ve=r(28),_e=r(5),we=r(3),Te=r(6),Oe=(Math.max(6378137,6378137,6356752.314245179),function(t){return t}),Ee=new m.e;function Se(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Oe;return Object(m.l)(t)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z),e}function Ae(t){return Se(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ee,m.i.cartographicRadians?Oe:m.n)}function ke(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Oe;return Object(m.l)(e)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]),e}function xe(t,e){return ke(t,e,m.i.cartographicRadians?Oe:m.m)}var Ne=new m.e,Me=new m.e,Ie=new m.e;var je=1e-14,Re=new m.e,Ce={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Pe={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Le={east:new m.e,north:new m.e,up:new m.e,west:new m.e,south:new m.e,down:new m.e},De=new m.e,Ue=new m.e,Be=new m.e;function Ve(t,e,r,n,i,s){var o,a,u,c=Ce[e]&&Ce[e][r];Object(m.g)(c&&(!n||n===c));var h=Re.copy(i);if(Object(m.k)(h.x,0,je)&&Object(m.k)(h.y,0,je)){var l=Math.sign(h.z);o=De.fromArray(Pe[e]),"east"!==e&&"west"!==e&&o.scale(l),a=Ue.fromArray(Pe[r]),"east"!==r&&"west"!==r&&a.scale(l),u=Be.fromArray(Pe[n]),"east"!==n&&"west"!==n&&u.scale(l)}else{var f=Le.up,d=Le.east,y=Le.north;d.set(-h.y,h.x,0).normalize(),t.geodeticSurfaceNormal(h,f),y.copy(f).cross(d);var p=Le.down,g=Le.west,b=Le.south;p.copy(f).scale(-1),g.copy(d).scale(-1),b.copy(y).scale(-1),o=Le[e],a=Le[r],u=Le[n]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=a.x,s[5]=a.y,s[6]=a.z,s[7]=0,s[8]=u.x,s[9]=u.y,s[10]=u.z,s[11]=0,s[12]=h.x,s[13]=h.y,s[14]=h.z,s[15]=1,s}var qe,Fe=new m.e,ze=new m.e,Ge=new m.e,$e=new m.e,He=new m.e,We=new m.e,Qe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(_e.a)(this,t),Object(m.g)(e>=0),Object(m.g)(r>=0),Object(m.g)(n>=0),this.radii=new m.e(e,r,n),this.radiiSquared=new m.e(e*e,r*r,n*n),this.radiiToTheFourth=new m.e(e*e*e*e,r*r*r*r,n*n*n*n),this.oneOverRadii=new m.e(0===e?0:1/e,0===r?0:1/r,0===n?0:1/n),this.oneOverRadiiSquared=new m.e(0===e?0:1/(e*e),0===r?0:1/(r*r),0===n?0:1/(n*n)),this.minimumRadius=Math.min(e,r,n),this.maximumRadius=Math.max(e,r,n),this.centerToleranceSquared=m.f.EPSILON1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return Object(we.a)(t,null,[{key:"WGS84",get:function(){return qe=qe||new t(6378137,6378137,6356752.314245179)}}]),Object(we.a)(t,[{key:"equals",value:function(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=ze,n=Ge,i=Object(ve.a)(t,3),s=i[2];this.geodeticSurfaceNormalCartographic(t,r),n.copy(this.radiiSquared).scale(r);var o=Math.sqrt(r.dot(n));return n.scale(1/o),r.scale(s),n.add(r),n.to(e)}},{key:"cartesianToCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];We.from(t);var r=this.scaleToGeodeticSurface(We,$e);if(r){var n=this.geodeticSurfaceNormal(r,ze),i=He;i.copy(We).subtract(r);var s=Math.atan2(n.y,n.x),o=Math.asin(n.z),a=Math.sign(Te.d(i,We))*Te.g(i);return xe([s,o,a],e)}}},{key:"eastNorthUpToFixedFrame",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new m.b;return Ve(this,"east","north","up",t,e)}},{key:"localFrameToFixedFrame",value:function(t,e,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new m.b;return Ve(this,t,e,r,n,i)}},{key:"geocentricSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Fe.from(t).normalize().to(e)}},{key:"geodeticSurfaceNormalCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=Ae(t),n=r[0],i=r[1],s=Math.cos(i);return Fe.set(s*Math.cos(n),s*Math.sin(n),Math.sin(i)).normalize(),Fe.to(e)}},{key:"geodeticSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Fe.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}},{key:"scaleToGeodeticSurface",value:function(t,e){return function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new m.e,n=e.oneOverRadii,i=e.oneOverRadiiSquared,s=e.centerToleranceSquared;Ne.from(t);var o=t.x,a=t.y,u=t.z,c=n.x,h=n.y,l=n.z,f=o*o*c*c,d=a*a*h*h,y=u*u*l*l,p=f+d+y,g=Math.sqrt(1/p);if(Number.isFinite(g)){var b=Me;if(b.copy(t).scale(g),p<s)return b.to(r);var v=i.x,_=i.y,w=i.z,T=Ie;T.set(b.x*v*2,b.y*_*2,b.z*w*2);var O,E,S,A,k=(1-g)*t.len()/(.5*T.len()),x=0;do{var N=(O=1/(1+(k-=x)*v))*O,M=(E=1/(1+k*_))*E,I=(S=1/(1+k*w))*S;x=(A=f*N+d*M+y*I-1)/(-2*(f*(N*O)*v+d*(M*E)*_+y*(I*S)*w))}while(Math.abs(A)>m.f.EPSILON12);return Ne.scale([O,E,S]).to(r)}}(t,this,e)}},{key:"scaleToGeocentricSurface",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];$e.from(t);var r=$e.x,n=$e.y,i=$e.z,s=this.oneOverRadiiSquared,o=1/Math.sqrt(r*r*s.x+n*n*s.y+i*i*s.z);return $e.multiplyScalar(o).to(e)}},{key:"transformPositionToScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return $e.from(t).scale(this.oneOverRadii).to(e)}},{key:"transformPositionFromScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return $e.from(t).scale(this.radii).to(e)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];Object(m.g)(Object(m.k)(this.radii.x,this.radii.y,m.f.EPSILON15)),Object(m.g)(this.radii.z>0),$e.from(t);var n=$e.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-e))return $e.set(0,0,n).to(r)}}]),t}();async function Ye(t,e,r,n,i){return r=function(t,e,r,n,i){if(r=L(t,e,r),1!==t.version)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);r=U(t,e,r);const s=new DataView(e);if(t.gltfFormat=s.getUint32(r,!0),r=B(t,e,r+=4),r=me(t,e,r),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new T(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",g.FLOAT,3);new C(t.batchTableJson,t.batchTableBinary,a);return function(t,e,r,n){const i=[new Array(n),t._batchTable][0],s=new m.e,o=new m.e,a=new m.e,u=new m.e,c=new m.a,h=new m.c,l=new m.e,f={},d=new m.b,y=[],p=[],b=new m.e,v=new m.e;for(let r=0;r<n;r++){let n;if(e.hasProperty("POSITION"))n=e.getProperty("POSITION",g.FLOAT,3,r,s);else if(e.hasProperty("POSITION_QUANTIZED")){n=e.getProperty("POSITION_QUANTIZED",g.UNSIGNED_SHORT,3,r,s);const t=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",g.FLOAT,3,b);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const i=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",g.FLOAT,3,v);if(!i)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const o=65535;for(let e=0;e<3;e++)n[e]=n[e]/o*i[e]+t[e]}if(!n)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");s.copy(n),f.translation=s,t.normalUp=e.getProperty("NORMAL_UP",g.FLOAT,3,r,y),t.normalRight=e.getProperty("NORMAL_RIGHT",g.FLOAT,3,r,p);const _=!1;if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",g.UNSIGNED_SHORT,2,y),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",g.UNSIGNED_SHORT,2,p),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(Qe.WGS84.eastNorthUpToFixedFrame(s,d),d.getRotationMatrix3(c)):c.identity()}_&&(u.copy(o).cross(a).normalize(),c.setColumn(0,o),c.setColumn(1,a),c.setColumn(2,u)),h.fromMatrix3(c),f.rotation=h,l.set(1,1,1);const w=e.getProperty("SCALE",g.FLOAT,1,r);Number.isFinite(w)&&l.multiplyByScalar(w);const T=e.getProperty("SCALE_NON_UNIFORM",g.FLOAT,3,r,y);T&&l.scale(T),f.scale=l;let O=e.getProperty("BATCH_ID",g.UNSIGNED_SHORT,1,r);void 0===O&&(O=r);const E=(new m.b).fromQuaternion(f.rotation);d.identity(),d.translate(f.translation),d.multiplyRight(E),d.scale(f.scale);const S=d.clone();i[r]={modelMatrix:S,batchId:O}}t.instances=i}(t,o,0,a),r}(t,e,r),await pe(t,t.gltfFormat,n,i),r}async function Ze(t,e=0,r,n,i={}){switch(r=r["3d-tiles"]||{},i.byteOffset=e,i.type=function(t,e=0){const r=new DataView(t);return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}(t,e),i.type){case u.COMPOSITE:return await async function(t,e,r,n,i,s){r=L(t,e,r);const o=new DataView(e);for(t.tilesLength=o.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-r>12;){const o={};t.tiles.push(o),r=await s(e,r,n,i,o)}return r}(i,t,e,r,n,Ze);case u.BATCHED_3D_MODEL:return await be(i,t,e,r,n);case u.INSTANCED_3D_MODEL:return await Ye(i,t,e,r,n);case u.POINT_CLOUD:return await Y(i,t,e,r,n);default:throw new Error(`3DTileLoader: unknown type ${i.type}`)}}var Ke={id:"3d-tiles",name:"3D Tiles",version:"2.0.4",extensions:["cmpt","pnts","b3dm","i3dm"],mimeType:"application/octet-stream",test:["cmpt","pnts","b3dm","i3dm"],parse:async function(t,e,r,n){const i={};return await Ze(t,0,e,r,i),i},binary:!0,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1}}};function Je(t,e,r){if(!e)return r+12;const{magic:n,version:i=1,byteLength:s=12}=t;return d(Array.isArray(n)&&Number.isFinite(i)&&Number.isFinite(s)),e.setUint8(r+0,n[0]),e.setUint8(r+1,n[1]),e.setUint8(r+2,n[2]),e.setUint8(r+3,n[3]),e.setUint32(r+4,i,!0),e.setUint32(r+8,s,!0),r+=12}function Xe(t,e,r){t&&t.setUint32(e+8,r,!0)}function tr(t,e,r,n){if(t)for(let i=0;i<n;i++)t.setUint8(e+i,r.charCodeAt(i));return e+n}const er={POINTS_LENGTH:1,POSITIONS:{byteOffset:0}};function rr(t,e,r,n){const{featureTableJson:i=er}=t;let s=JSON.stringify(i);s=function(t,e){const r=t.length,n=Math.ceil(r/e)*e-r;let i="";for(let t=0;t<n;++t)i+=" ";return t+i}(s,4);const{featureTableJsonByteLength:o=s.length}=t,a=new ArrayBuffer(12),u=a.byteLength,h=r;return r+=Je(t={magic:c.POINT_CLOUD,...t},e,0),e&&(e.setUint32(r+0,o,!0),e.setUint32(r+4,u,!0),e.setUint32(r+8,0,!0),e.setUint32(r+12,0,!0)),r+=16,r+=tr(e,r,s,o),r+=function(t,e,r,n){if(t)for(let i=0;i<n;i++)t.setUint8(e+i,r[i]),e++;return e+n}(e,r,a,u),Xe(e,h,r-h),r}function nr(t,e,r,n){switch(O("string"==typeof t.type),t.type){case u.COMPOSITE:return function(t,e,r,n,i){const s=r;r+=Je(t={magic:c.COMPOSITE,tiles:[],...t},e,r),e&&e.setUint32(r,t.tiles.length,!0),r+=4;for(let s=0;s<t.tiles.length;++s)r+=i(t.tiles[s],e,r,n);return Xe(e,s,r-s),r}(t,e,r,n,nr);case u.POINT_CLOUD:return rr(t,e,r);case u.BATCHED_3D_MODEL:return function(t,e,r,n){const{featuresLength:i=1}=t,s={BATCH_LENGTH:i},o=JSON.stringify(s),a=o.length,u=r;return r=Je(t={magic:c.BATCHED_MODEL,...t},e,r),e&&(e.setUint32(12,a,!0),e.setUint32(16,0,!0),e.setUint32(20,0,!0),e.setUint32(24,0,!0)),r+=16,Xe(e,u,(r+=tr(e,r,o,a))-u),r}(t,e,r);case u.INSTANCED_3D_MODEL:return function(t,e,r,n){const{featuresLength:i=1,gltfFormat:s=1,gltfUri:o=""}=t,a=o.length,u={INSTANCES_LENGTH:i,POSITION:new Array(3*i).fill(0)},h=JSON.stringify(u),l=h.length,f=r;return Je(t={magic:c.INSTANCED_MODEL,...t},e,0),e&&(e.setUint32(12,l,!0),e.setUint32(16,0,!0),e.setUint32(20,0,!0),e.setUint32(24,0,!0),e.setUint32(28,s,!0)),r+=tr(e,r,h,l),Xe(e,f,(r+=tr(e,r,o,a))-f),r}(t,e,r);default:throw new Error("3D Tiles: unknown tile type")}}var ir={name:"GLB",extensions:["cmpt","pnts","b3dm","i3dm"],mimeType:"application/octet-stream",encodeSync:function(t,e){return function(t,e){const r=nr(t,null,0,e),n=new ArrayBuffer(r);return nr(t,new DataView(n),0,e),n}(t,e)},binary:!0};var sr=r(22),or=function(){function t(e,r){Object(_e.a)(this,t),this.name=e,this.type=r,this.sampleSize=1,this.reset()}return Object(we.a)(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Object(sr.a)(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Object(sr.a)()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}(),ar=function(){function t(e){var r=e.id,n=e.stats;Object(_e.a)(this,t),this.id=r,this.stats={},this._initializeStats(n),Object.seal(this)}return Object(we.a)(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach((function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}},{key:"_initializeStats",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e){return t._getOrCreate(e)}))}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name,r=t.type;return this.stats[e]||(this.stats[e]=t instanceof or?t:new or(e,r)),this.stats[e]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),t}();function ur(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}const cr="Queued Requests",hr="Active Requests",lr="Cancelled Requests",fr="Queued Requests Ever",dr="Active Requests Ever",yr={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class mr{constructor(t={}){this.props={...t,...yr},this.requestQueue=[],this.activeRequestCount=0,this.requestMap={},this.stats=new ar({id:t.id}),this.stats.get(cr),this.stats.get(hr),this.stats.get(lr),this.stats.get(fr),this.stats.get(dr)}scheduleRequest(t,e=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve(t);if(this.requestMap[t.id])return this.requestMap[t.id];let r=null;const n=new Promise((n,i)=>(r={handle:t,callback:e,resolve:n,reject:i},r));return this.requestQueue.push({promise:n,...r}),this.requestMap[t.id]=n,this._issueNewRequests(),n}startRequest(t){this.activeRequestCount++}endRequest(t){this.requestMap[t.id]&&delete this.requestMap[t.id],this.activeRequestCount--,this._issueNewRequests()}trackRequestPromise(t,e){this.startRequest(t),e.then(()=>this.endRequest(t)).catch(()=>this.endRequest(t))}_issueNewRequests(){this._updateNeeded=!0,setTimeout(()=>this._issueNewRequestsAsync(),0)}_issueNewRequestsAsync(){this._updateNeeded=!1;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(let e=0;e<t;++e)if(this.requestQueue.length>0){this.requestQueue.shift().resolve(!0)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const r=t[e];this._updateRequest(r)||(t.splice(e,1),delete this.requestMap[r.handle.id],e--)}t.sort((t,e)=>t.priority-e.priority)}_updateRequest(t){return t.priority=t.callback(t.handle),!(t.priority<0)||(t.resolve(!1),!1)}}var pr=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),gr=pr,br=new m.e,vr=new m.e,_r=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(_e.a)(this,t),n=n||br.copy(e).add(r).scale(.5),this.minimum=new m.e(e),this.maximum=new m.e(r),this.center=new m.e(n)}Object(we.a)(t,[{key:"fromPoints",value:function(t){if(!t||0===t.length)return this.minimum.set(0,0,0),this.maximum.set(0,0,0),this.center.set(0,0,0),this;var e=t[0][0],r=t[0][1],n=t[0][2],i=t[0][0],s=t[0][1],o=t[0][2],a=!0,u=!1,c=void 0;try{for(var h,l=t[Symbol.iterator]();!(a=(h=l.next()).done);a=!0){var f=h.value,d=f[0],y=f[1],m=f[2];e=Math.min(d,e),i=Math.max(d,i),r=Math.min(y,r),s=Math.max(y,s),n=Math.min(m,n),o=Math.max(m,o)}}catch(t){u=!0,c=t}finally{try{a||null==l.return||l.return()}finally{if(u)throw c}}return this.minimum.set(e,r,n),this.maximum.set(i,s,o),this.center.copy(this.minimum).add(this.maximum).scale(.5),this}},{key:"clone",value:function(){return new t(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}},{key:"intersectPlane",value:function(t){var e=br.copy(this.maximum).subtract(this.minimum).scale(.5),r=vr.from(t.normal),n=e.x*Math.abs(r.x)+e.y*Math.abs(r.y)+e.z*Math.abs(r.z),i=this.center.dot(r)+t.distance;return i-n>0?gr.INSIDE:i+n<0?gr.OUTSIDE:gr.INTERSECTING}}])}(),r(8)),wr=new m.e,Tr=new m.e,Or=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(_e.a)(this,t),this.radius=-0,this.center=new m.e,this.fromCenterRadius(e,r)}return Object(we.a)(t,[{key:"fromCenterRadius",value:function(t,e){return this.center.from(t),this.radius=e,this}},{key:"fromCornerPoints",value:function(t,e){return e=wr.from(e),this.center=(new m.e).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}},{key:"clone",value:function(){return new t(this.center,this.radius)}},{key:"union",value:function(t){var e=this.center,r=this.radius,n=t.center,i=t.radius,s=wr.copy(n).subtract(e),o=s.magnitude();if(r>=o+i)return this.clone();if(i>=o+r)return t.clone();var a=.5*(r+o+i);return Tr.copy(s).scale((-r+a)/o).add(e),this.center.copy(Tr),this.radius=a,this}},{key:"expand",value:function(t){var e=(t=wr.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}},{key:"intersectPlane",value:function(t){var e=this.center,r=this.radius,n=t.normal.dot(e)+t.distance;return n<-r?gr.OUTSIDE:n<r?gr.INTERSECTING:gr.INSIDE}},{key:"transform",value:function(t){this.center.transform(t);var e=_r.d(wr,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(t){return(t=wr.from(t)).subtract(this.center).lengthSquared()-this.radius*this.radius}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}}]),t}(),Er=new m.a,Sr=new m.a,Ar=new m.a,kr=new m.a,xr=new m.a;function Nr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=m.f.EPSILON20,n=0,i=0,s=Sr,o=Ar;s.identity(),o.copy(t);for(var a=r*function(t){for(var e=0,r=0;r<9;++r){var n=t[r];e+=n*n}return Math.sqrt(e)}(o);i<10&&jr(o)>a;)Rr(o,kr),xr.copy(kr).transpose(),o.multiplyRight(kr),o.multiplyLeft(xr),s.multiplyRight(kr),++n>2&&(++i,n=0);return e.unitary=s.toTarget(e.unitary),e.diagonal=o.toTarget(e.diagonal),e}var Mr=[1,0,0],Ir=[2,2,1];function jr(t){for(var e=0,r=0;r<3;++r){var n=t[Er.getElementIndex(Ir[r],Mr[r])];e+=2*n*n}return Math.sqrt(e)}function Rr(t,e){for(var r=m.f.EPSILON15,n=0,i=1,s=0;s<3;++s){var o=Math.abs(t[Er.getElementIndex(Ir[s],Mr[s])]);o>n&&(i=s,n=o)}var a=Mr[i],u=Ir[i],c=1,h=0;if(Math.abs(t[Er.getElementIndex(u,a)])>r){var l,f=(t[Er.getElementIndex(u,u)]-t[Er.getElementIndex(a,a)])/2/t[Er.getElementIndex(u,a)];h=(l=f<0?-1/(-f+Math.sqrt(1+f*f)):1/(f+Math.sqrt(1+f*f)))*(c=1/Math.sqrt(1+l*l))}return m.a.IDENTITY.to(e),e[Er.getElementIndex(a,a)]=e[Er.getElementIndex(u,u)]=c,e[Er.getElementIndex(u,a)]=h,e[Er.getElementIndex(a,u)]=-h,e}var Cr=new m.e,Pr=new m.e,Lr=new m.e,Dr=new m.e,Ur=new m.e,Br=new m.a,Vr={diagonal:new m.a,unitary:new m.a};function qr(t,e){if(!t||0===t.length)return e.halfAxes=new m.a([0,0,0,0,0,0,0,0,0]),e.center=new m.e,e;var r=t.length,n=new m.e(0,0,0),i=!0,s=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c=a.value;n.add(c)}}catch(t){s=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(s)throw o}}var h=1/r;n.multiplyByScalar(h);var l=0,f=0,d=0,y=0,p=0,g=0,b=!0,v=!1,_=void 0;try{for(var w,T=t[Symbol.iterator]();!(b=(w=T.next()).done);b=!0){var O=w.value,E=Cr.copy(O).subtract(n);l+=E.x*E.x,f+=E.x*E.y,d+=E.x*E.z,y+=E.y*E.y,p+=E.y*E.z,g+=E.z*E.z}}catch(t){v=!0,_=t}finally{try{b||null==T.return||T.return()}finally{if(v)throw _}}l*=h,f*=h,d*=h,y*=h,p*=h,g*=h;var S=Br;S[0]=l,S[1]=f,S[2]=d,S[3]=f,S[4]=y,S[5]=p,S[6]=d,S[7]=p,S[8]=g;var A=Nr(S,Vr).unitary,k=e.halfAxes.copy(A),x=k.getColumn(0,Lr),N=k.getColumn(1,Dr),M=k.getColumn(2,Ur),I=-Number.MAX_VALUE,j=-Number.MAX_VALUE,R=-Number.MAX_VALUE,C=Number.MAX_VALUE,P=Number.MAX_VALUE,L=Number.MAX_VALUE,D=!0,U=!1,B=void 0;try{for(var V,q=t[Symbol.iterator]();!(D=(V=q.next()).done);D=!0){var F=V.value;I=Math.max(F.dot(x),I),j=Math.max(F.dot(N),j),R=Math.max(F.dot(M),R),C=Math.min(F.dot(x),C),P=Math.min(F.dot(N),P),L=Math.min(F.dot(M),L)}}catch(t){U=!0,B=t}finally{try{D||null==q.return||q.return()}finally{if(U)throw B}}x=x.multiplyByScalar(.5*(C+I)),N=N.multiplyByScalar(.5*(P+j)),M=M.multiplyByScalar(.5*(L+R)),e.center.copy(x).add(N).add(M);var z=Pr.set(I-C,j-P,R-L).multiplyByScalar(.5);return e.halfAxes.multiplyByScalar(z),e}var Fr=new m.e,zr=new m.e,Gr=new m.e,$r=new m.e,Hr=new m.e,Wr=new m.e,Qr=new m.e,Yr=new m.e,Zr=new m.e,Kr=new m.e,Jr=new m.e,Xr=0,tn=1,en=2,rn=3,nn=4,sn=5,on=6,an=7,un=8,cn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];Object(_e.a)(this,t),this.center=(new m.e).from(e),this.halfAxes=new m.a(r)}return Object(we.a)(t,[{key:"clone",value:function(e){return new t(this.center,this.halfAxes)}},{key:"fromPoints",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t;return qr(e,r)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Or,e=this.halfAxes,r=e.getColumn(0,Zr),n=e.getColumn(1,Kr),i=e.getColumn(2,Jr),s=Fr.copy(r).add(n).add(i);return t.center.copy(this.center),t.radius=s.magnitude(),t}},{key:"intersectPlane",value:function(t){var e=this.center,r=t.normal,n=this.halfAxes,i=r.x,s=r.y,o=r.z,a=Math.abs(i*n[Xr]+s*n[tn]+o*n[en])+Math.abs(i*n[rn]+s*n[nn]+o*n[sn])+Math.abs(i*n[on]+s*n[an]+o*n[un]),u=r.dot(e)+t.distance;return u<=-a?gr.OUTSIDE:u>=a?gr.INSIDE:gr.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e=zr.from(t).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,Gr),i=r.getColumn(1,$r),s=r.getColumn(2,Hr),o=n.magnitude(),a=i.magnitude(),u=s.magnitude();n.normalize(),i.normalize(),s.normalize();var c=Wr;c.x=e.dot(n),c.y=e.dot(i),c.z=e.dot(s);var h,l=0;return c.x<-o?l+=(h=c.x+o)*h:c.x>o&&(l+=(h=c.x-o)*h),c.y<-a?l+=(h=c.y+a)*h:c.y>a&&(l+=(h=c.y-a)*h),c.z<-u?l+=(h=c.z+u)*h:c.z>u&&(l+=(h=c.z-u)*h),l}},{key:"computePlaneDistances",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[[],[]],n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=this.center,o=this.halfAxes,a=o.getColumn(0,Gr),u=o.getColumn(1,$r),c=o.getColumn(2,Hr),h=Qr.copy(a).add(u).add(c).add(s),l=Yr.copy(h).subtract(t),f=e.dot(l);return n=Math.min(f,n),i=Math.max(f,i),h.copy(s).add(a).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),h.copy(s).add(a).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),h.copy(s).add(a).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),s.copy(h).subtract(a).add(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),s.copy(h).subtract(a).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),s.copy(h).subtract(a).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),s.copy(h).subtract(a).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),r.start=n,r.stop=i,r}},{key:"getTransform",value:function(){}}]),t}(),hn=new m.e,ln=new m.e,fn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(_e.a)(this,t),this.normal=new m.e,this.distance=-0,this.fromNormalDistance(e,r)}return Object(we.a)(t,[{key:"fromNormalDistance",value:function(t,e){return Object(m.g)(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}},{key:"fromPointNormal",value:function(t,e){t=hn.from(t),this.normal.from(e).normalize();var r=-this.normal.dot(t);return this.distance=r,this}},{key:"fromCoefficients",value:function(t,e,r,n){return this.normal.set(t,e,r),Object(m.g)(Object(m.k)(this.normal.len(),1)),this.distance=n,this}},{key:"clone",value:function(e){return new t(this.normal,this.distance)}},{key:"equals",value:function(t){return Object(m.k)(this.distance,t.distance)&&Object(m.k)(this.normal,t.normal)}},{key:"getPointDistance",value:function(t){return this.normal.dot(t)+this.distance}},{key:"transform",value:function(t){var e=ln.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,e)}},{key:"projectPointOntoPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];t=hn.from(t);var r=this.getPointDistance(t),n=ln.copy(this.normal).scale(r);return t.subtract(n).to(e)}}]),t}(),dn=[new m.e([1,0,0]),new m.e([0,1,0]),new m.e([0,0,1])],yn=new m.e,mn=new m.e,pn=(new fn(new m.e(1,0,0),0),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(_e.a)(this,t),this.planes=e,Object(m.g)(this.planes.every((function(t){return t instanceof fn})))}return Object(we.a)(t,null,[{key:"MASK_OUTSIDE",get:function(){return 4294967295}},{key:"MASK_INSIDE",get:function(){return 0}},{key:"MASK_INDETERMINATE",get:function(){return 2147483647}}]),Object(we.a)(t,[{key:"fromBoundingSphere",value:function(t){this.planes.length=2*dn.length;var e=t.center,r=t.radius,n=0,i=!0,s=!1,o=void 0;try{for(var a,u=dn[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c=a.value,h=this.planes[n],l=this.planes[n+1];h||(h=this.planes[n]=new fn),l||(l=this.planes[n+1]=new fn);var f=yn.copy(c).scale(-r).add(e);c.dot(f);h.fromPointNormal(f,c);var d=yn.copy(c).scale(r).add(e),y=mn.copy(c).negate();y.dot(d);l.fromPointNormal(d,y),n+=2}}catch(t){s=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(s)throw o}}return this}},{key:"computeVisibility",value:function(t){Object(m.g)(t);var e=gr.INSIDE,r=!0,n=!1,i=void 0;try{for(var s,o=this.planes[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var a=s.value;switch(t.intersectPlane(a)){case gr.OUTSIDE:return gr.OUTSIDE;case gr.INTERSECTING:e=gr.INTERSECTING}}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return e}},{key:"computeVisibilityWithPlaneMask",value:function(e,r){if(Object(m.g)(e,"boundingVolume is required."),Object(m.g)(Number.isFinite(r),"parentPlaneMask is required."),r===t.MASK_OUTSIDE||r===t.MASK_INSIDE)return r;for(var n=t.MASK_INSIDE,i=this.planes,s=0;s<this.planes.length;++s){var o=s<31?1<<s:0;if(!(s<31&&0==(r&o))){var a=i[s],u=e.intersectPlane(a);if(u===gr.OUTSIDE)return t.MASK_OUTSIDE;u===gr.INTERSECTING&&(n|=o)}}return n}}]),t}());function gn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function bn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var vn=new m.e,_n=new m.e,wn=new m.e,Tn=new m.e,On=new m.e,En=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(_e.a)(this,t),e=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?bn(r,!0).forEach((function(e){gn(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bn(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({near:1,far:5e8},e),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this._cullingVolume=new pn([new fn,new fn,new fn,new fn,new fn,new fn]),this._perspectiveMatrix=new m.b,this._infinitePerspective=new m.b}return Object(we.a)(t,[{key:"clone",value:function(){return new t({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}},{key:"equals",value:function(e){return e&&e instanceof t&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}},{key:"computeCullingVolume",value:function(t,e,r){Object(m.g)(t,"position is required."),Object(m.g)(e,"direction is required."),Object(m.g)(r,"up is required.");var n=this._cullingVolume.planes;r=vn.copy(r).normalize();var i=_n.copy(e).cross(r).normalize(),s=wn.copy(e).multiplyByScalar(this.near).add(t),o=Tn.copy(e).multiplyByScalar(this.far).add(t),a=On;return a.copy(i).multiplyByScalar(this.left).add(s).subtract(t).cross(r),n[0].fromPointNormal(t,a),a.copy(i).multiplyByScalar(this.right).add(s).subtract(t).cross(r).negate(),n[1].fromPointNormal(t,a),a.copy(r).multiplyByScalar(this.bottom).add(s).subtract(t).cross(i).negate(),n[2].fromPointNormal(t,a),a.copy(r).multiplyByScalar(this.top).add(s).subtract(t).cross(i),n[3].fromPointNormal(t,a),a=(new m.e).copy(e),n[4].fromPointNormal(s,a),a.negate(),n[5].fromPointNormal(o,a),this._cullingVolume}},{key:"getPixelDimensions",value:function(t,e,r,n){Sn(this),Object(m.g)(Number.isFinite(t)&&Number.isFinite(e)),Object(m.g)(t>0),Object(m.g)(e>0),Object(m.g)(r>0),Object(m.g)(n);var i=1/this.near,s=this.top*i,o=2*r*s/e,a=2*r*(s=this.right*i)/t;return n.x=a,n.y=o,n}},{key:"projectionMatrix",get:function(){return Sn(this),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return Sn(this),this._infinitePerspective}}]),t}();function Sn(t){Object(m.g)(Number.isFinite(t.right)&&Number.isFinite(t.left)&&Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t.top,r=t.bottom,n=t.right,i=t.left,s=t.near,o=t.far;e===t._top&&r===t._bottom&&i===t._left&&n===t._right&&s===t._near&&o===t._far||(Object(m.g)(t.near>0&&t.near<t.far,"near must be greater than zero and less than far."),t._left=i,t._right=n,t._top=e,t._bottom=r,t._near=s,t._far=o,t._perspectiveMatrix=(new m.b).frustum({left:i,right:n,bottom:r,top:e,near:s,far:o}),t._infinitePerspective=(new m.b).frustum({left:i,right:n,bottom:r,top:e,near:s,far:1/0}))}function An(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}!function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(_e.a)(this,t),e=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?An(r,!0).forEach((function(e){gn(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):An(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({near:1,far:5e8,xOffset:0,yOffset:0},e),this._offCenterFrustum=new En,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this.xOffset=e.xOffset,this._xOffset=this.xOffset,this.yOffset=e.yOffset,this._yOffset=this.yOffset}Object(we.a)(t,[{key:"clone",value:function(){return new t({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}},{key:"equals",value:function(e){return null!=e&&e instanceof t&&(kn(this),kn(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}},{key:"computeCullingVolume",value:function(t,e,r){return kn(this),this._offCenterFrustum.computeCullingVolume(t,e,r)}},{key:"getPixelDimensions",value:function(t,e,r,n){return kn(this),this._offCenterFrustum.getPixelDimensions(t,e,r,n)}},{key:"projectionMatrix",get:function(){return kn(this),this._offCenterFrustum.projectionMatrix}},{key:"infiniteProjectionMatrix",get:function(){return kn(this),this._offCenterFrustum.infiniteProjectionMatrix}},{key:"fovy",get:function(){return kn(this),this._fovy}},{key:"sseDenominator",get:function(){return kn(this),this._sseDenominator}}])}();function kn(t){Object(m.g)(Number.isFinite(t.fov)&&Number.isFinite(t.aspectRatio)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(Object(m.g)(t.fov>=0&&t.fov<Math.PI),Object(m.g)(t.aspectRatio>0),Object(m.g)(t.near>=0&&t.near<t.far),t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset)}new m.e,new m.e,new m.e,new m.e,new m.e,new m.e,new m.e,new m.e,new m.e,new m.e,new m.e,new m.e,Math.PI;const xn=new m.e,Nn=new m.e,Mn=new pn([new fn,new fn,new fn,new fn,new fn,new fn]);function In(t,e){const{cameraDirection:r,cameraUp:n,height:i}=t,{metersPerUnit:s}=t.distanceScales,o=[t.longitude,t.latitude,0],a=Qe.WGS84.cartographicToCartesian(o,new m.e),u=Qe.WGS84.eastNorthUpToFixedFrame(a),c=t.unprojectPosition(t.cameraPosition),h=Qe.WGS84.cartographicToCartesian(c,new m.e),l=new m.e(u.transformAsVector(new m.e(r).scale(s))).normalize(),f=new m.e(u.transformAsVector(new m.e(n).scale(s))).normalize();return function(t,e){const r=t.getFrustumPlanes();let n=0;for(const i in r){const s=r[i],o=s.normal.dot(t.center);Nn.copy(s.normal).scale(s.distance-o).add(t.center);const a=t.unprojectPosition(Nn),u=Qe.WGS84.cartographicToCartesian(a,new m.e);Mn.planes[n++].fromPointNormal(u,xn.copy(e).subtract(u))}}(t,a),{camera:{position:h,direction:l,up:f},height:i,cullingVolume:Mn,frameNumber:e,sseDenominator:1.15}}function jn(t,e){d(t),d(e);const{rtcCenter:r,rotateYtoZ:n}=e,{computedTransform:i,_boundingVolume:{center:s}}=t;let o=new m.b(i);if(r&&o.translate(r),n){const t=(new m.b).rotateX(Math.PI/2);o=o.multiplyRight(t)}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new m.e(s);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const u=Qe.WGS84.cartesianToCartographic(a,new m.e),c=Qe.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=c.multiplyRight(o),e.cartographicOrigin=u,e.modelMatrix=e.cartographicModelMatrix}let Rn="";const Cn={};const Pn=t=>"undefined"!=typeof Response&&t instanceof Response||t.arrayBuffer&&t.text&&t.json,Ln=t=>(t=>"undefined"!=typeof File&&t instanceof File)(t)||(t=>"undefined"!=typeof Blob&&t instanceof Blob)(t);class Dn{constructor(t){this._fileOrBlob=t,this.bodyUsed=!1}get headers(){return new Headers({"Content-Length":this._fileOrBlob.size,"Content-Type":this._fileOrBlob.type})}get ok(){return!0}get status(){return 200}get url(){return this._fileOrBlob.name||""}async arrayBuffer(){const{reader:t,promise:e}=this._getFileReader();return t.readAsArrayBuffer(this._fileOrBlob),e}async text(){const{reader:t,promise:e}=this._getFileReader();return t.readAsText(this._fileOrBlob),e}async json(){const t=await this.text();return JSON.parse(t)}_getFileReader(){let t;d(!this.bodyUsed),this.bodyUsed=!0;const e=new Promise((e,r)=>{try{t=new FileReader,t.onerror=t=>r(new Error(t)),t.onabort=()=>r(new Error("Read aborted.")),t.onload=()=>e(t.result)}catch(t){r(t)}});return{reader:t,promise:e}}}function Un(t,e){return Promise.resolve(new Dn(t,e))}async function Bn(t,e){return Ln(t)?Un(t,e):(t=function(t){for(const e in Cn)if(t.startsWith(e)){const r=Cn[e];return t.replace(e,r)}return t+=Rn}(t),fetch(t,e))}const Vn="2.0.4";function qn(t){const e=t.split(".").map(Number);return{major:e[0],minor:e[1]}}function Fn(t){if(!t)return!1;Array.isArray(t)&&(t=t[0]);let e=t.parseTextSync||t.parseSync||t.parse||t.parseStream||t.parseInBatches;const r=t.options&&t.options[t.id];return e=e||r&&r.workerUrl,e}function zn(t){let e;return d(t,"null loader"),d(Fn(t),"invalid loader"),Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),t.extension&&(t.extensions=t.extensions||t.extension,delete t.extension),Array.isArray(t.extensions)||(t.extensions=[t.extensions]),d(t.extensions&&t.extensions.length>0&&t.extensions[0]),t.parseTextSync&&(t.text=!0),t.text||(t.binary=!0),t}class Gn{log(){return t=>{}}info(){return t=>{}}warn(){return t=>{}}error(){return t=>{}}}const $n={CDN:"https://unpkg.com/@loaders.gl",worker:!0,log:new class{constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}},dataType:"arraybuffer"},Hn=t=>t&&"object"==typeof t&&t.constructor==={}.constructor;let Wn={...$n};function Qn(t,e,r){const n={...t&&(t.DEFAULT_LOADER_OPTIONS||t.defaultOptions||t.options||{})};return function(t,e){!e||"baseUri"in t||(t.baseUri=e)}(n,r),null===n.log&&(n.log=new Gn),Yn(n,Wn),Yn(n,e),n}function Yn(t,e){for(const r in e)if(r in e){const n=e[r];Hn(n)&&Hn(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}r(59);const Zn="Cannot convert supplied data type";async function Kn(t,e){const r=(t=await t)instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||r)return function(t,e){if(e.text&&"string"==typeof t)return t;if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){const r=t.buffer||t;if(e.text&&!e.binary){return new TextDecoder("utf8").decode(r)}return r}throw new Error(Zn)}(t,e);if(Ln(t)&&(t=await Un(t)),Pn(t)){const r=t;return await async function(t){if(!t.ok){let e=`fetch failed ${t.status} `;try{e+=await t.text()}catch(t){}throw new Error(e)}}(r),e.binary?await r.arrayBuffer():await r.text()}throw new Error(Zn)}var Jn=r(31);function Xn(t){if(Jn.toArrayBuffer&&(t=Object(Jn.toArrayBuffer)(t)),t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.buffer;if("string"==typeof t){const e=t;return(new TextEncoder).encode(e).buffer}return d(!1)}const ti=new Map;function ei(t){return!!t&&(t instanceof ArrayBuffer||t.buffer instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}function ri(t,e=!0,r=[]){if(t){if(ei(t))r.push(t);else if(ei(t.buffer))r.push(t.buffer);else if(e&&"object"==typeof t)for(const n in t)ri(t[n],e,r)}else;return r}let ni=0;function ii({data:t,resolve:e}){e(t)}class si{constructor({source:t,name:e=`web-worker-${ni++}`,onMessage:r}){const n=function(t,e="Worker"){if(d("string"==typeof t,"worker source"),t.startsWith("url(")&&t.endsWith(")")){const e=t.match(/^url\((.*)\)$/)[1];if(e&&!e.startsWith("http"))return e;t=function(t){return`try {\n  importScripts('${t}');\n} catch (error) {\n  console.error(error);\n}`}(e)}let r=ti.get(t);if(!r){const e=new Blob([t],{type:"application/javascript"});r=URL.createObjectURL(e),ti.set(t,r)}return r}(t,e);this.worker=new Worker(n,{name:e}),this.name=e,this.onMessage=r||ii}async process(t){return new Promise((e,r)=>{this.worker.onmessage=t=>this.onMessage({worker:this.worker,data:t.data,resolve:e,reject:r}),this.worker.onerror=t=>{let e=`${this.name}: WorkerThread.process() failed`;t.message&&(e+=` ${t.message} ${t.filename}:${t.lineno}:${t.colno}`);const n=new Error(e);console.error(t),r(n)};const n=ri(t);this.worker.postMessage(t,n)})}destroy(){this.worker.terminate(),this.worker=null}}class oi{constructor({source:t,name:e="unnamed",maxConcurrency:r=1,onMessage:n,onDebug:i=(()=>{})}){this.source=t,this.name=e,this.maxConcurrency=r,this.onMessage=n,this.onDebug=i,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}async process(t,e){return new Promise((r,n)=>{this.jobQueue.push({data:t,jobName:e,resolve:r,reject:n}),this._startQueuedJob()})}_startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();this.onDebug({message:"processing",worker:t.name,job:e.jobName,backlog:this.jobQueue.length}),t.process(e.data).then(t=>e.resolve(t)).catch(t=>e.reject(t)).then(()=>this._onWorkerDone(t))}_onWorkerDone(t){this.isDestroyed?t.destroy():(this.idleQueue.push(t),this._startQueuedJob())}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift();if(this.count<this.maxConcurrency){this.count++;const t=`${this.name.toLowerCase()}-worker (#${this.count} of ${this.maxConcurrency})`;return new si({source:this.source,onMessage:this.onMessage,name:t})}return null}}const ai=5;class ui{static isSupported(){return"undefined"!=typeof Worker}constructor({maxConcurrency:t=ai,onMessage:e,onDebug:r=(()=>{})}){this.maxConcurrency=t,this.onMessage=e,this.onDebug=r,this.workerPools=new Map}setProps(t){"maxConcurrency"in t&&(this.maxConcurrency=t.maxConcurrency),"onDebug"in t&&(this.onDebug=t.onDebug)}destroy(){this.workerPools.forEach(t=>t.destroy())}async process(t,e,r){return this._getWorkerPool(t,e).process(r)}_getWorkerPool(t,e){let r=this.workerPools.get(e);return r||(r=new oi({source:t,name:e,onMessage:this.onMessage,maxConcurrency:this.maxConcurrency,onDebug:this.onDebug}),this.workerPools.set(e,r)),r}}const ci="2.0.4";function hi(t,e,r,n){const{worker:i}=r||{},s=r&&r[t.id]||{},o=`url(${"local"===i?s.localWorkerUrl:s.workerUrl})`,a=t.name,u=function(t={}){const e={};t.maxConcurrency&&(e.maxConcurrency=t.maxConcurrency);t.onDebug&&(e.onDebug=t.onDebug);li||(li=new ui({onMessage:fi}));return li.setProps(e),li}(r);r=JSON.parse(JSON.stringify(r));const c=t.version!==ci?`(core version ${ci})`:"";return u.process(o,`loaders.gl@${t.version}${c}:${a}`,{arraybuffer:Xn(e),options:r,source:`loaders.gl@${ci}`,type:"parse"})}let li=null;async function fi({worker:t,data:e,resolve:r,reject:n}){switch(e.type){case"done":r(e.result);break;case"parse":try{const r=await wi(e.arraybuffer,e.options,e.url);t.postMessage({type:"parse-done",id:e.id,result:r},ri(r))}catch(r){t.postMessage({type:"parse-error",id:e.id,message:r.message})}break;case"error":n(e.message)}}let di=[];const yi=/\.([^.]+)$/,mi=/^data:(.*?)(;|,)/;function pi(t,e="",r=null,{nothrow:n=!1}={}){if(e=e||"",t&&!Array.isArray(t)){const e=t;return zn(e),e}!function(t){for(const e of t)zn(e)}(t=[...t||[],...di]);let i=function(t,e){let r=e.match(mi);const n=r&&r[1];if(n)return gi(t,n);r=e.match(yi);const i=r&&r[1];return i&&function(t,e){e=e.toLowerCase();for(const r of t)for(const t of r.extensions)if(t.toLowerCase()===e)return r;return null}(t,i)}(t,e=e.replace(/\?.*/,""));if(i=i||function(t,e){if(!e||!Pn(e)||!e.headers)return null;const r=e.headers.get("content-type");return gi(t,r)}(t,r),i=i||function(t,e){if(!e)return null;for(const r of t)if("string"==typeof e){if(bi(e,r))return r}else if(ArrayBuffer.isView(e)){if(vi(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer){if(vi(e,0,r))return r}return null}(t,r),!i){if(n)return null;let t="No valid loader found";throw r&&(t+=` for data starting with "${function(t,e=5){if("string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return _i(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){return _i(t,0,e)}return""}(r)}"`),e&&(t+=` for ${e}`),new Error(t)}return i}function gi(t,e){for(const r of t)if(r.mimeTypes&&r.mimeTypes.includes(e))return r;return null}function bi(t,e){return e.testText&&e.testText(t)}function vi(t,e,r){switch(Array.isArray(r.test)?"array":typeof r.test){case"function":return r.test(t,r);case"string":case"array":return(Array.isArray(r.test)?r.test:[r.test]).some(r=>{return r===_i(t,e,r.length)});default:return!1}}function _i(t,e,r){if(t.byteLength<=e+r)return"";const n=new DataView(t);let i="";for(let t=0;t<r;t++)i+=String.fromCharCode(n.getUint8(e+t));return i}async function wi(t,e,r,n){!e||Array.isArray(e)||Fn(e)||(n=r,r=e,e=null);let i="";"string"==typeof n&&(i=n,n=null),r=r||{};const s=function(t,e){return Pn(t)?e=e||t.url:Ln(e)&&(e=e.name),"string"==typeof e?e.replace(/\?.*/,""):e}(t,i),o=function(t,e){if(!e&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...t]:t}return r&&r.length?r:null}(e,n),a=pi(o,s,t);return a?(r=Qn(a,r,s),n=function(t,e,r){return r||(t={fetch:t.fetch||Bn,...t},Array.isArray(t.loaders)||(t.loaders=null),t)}({url:s,parse:wi,loaders:o},0,n),await async function(t,e,r,n){if(function(t,e=Vn){d(t,"no loader provided");let r=t.version;e&&r&&(e=qn(e),r=qn(r))}(t),e=await Kn(e,t),t.parseTextSync&&"string"==typeof e)return r.dataType="text",t.parseTextSync(e,r,n,t);if(function(t,e,r,n){if(!ui.isSupported())return!1;const i=r&&r[t.id];return!!("local"===r.worker&&i&&i.localWorkerUrl||r.worker&&i&&i.workerUrl)&&(!t.useWorker||t.useWorker(r))}(t,0,r))return await hi(t,e,r);if(t.parse)return await t.parse(e,r,n,t);return d(!t.parseSync),d(!1)}(a,t,r,n)):null}const Ti=t=>void 0!==t,Oi=(new m.a,new m.e),Ei=new m.e,Si=new m.e;new m.b;function Ai(t,e,r){if(O(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,r){const n=new m.e(t[0],t[1],t[2]);e.transform(n,n);const i=e.transformAsVector(t.slice(3,6)),s=e.transformAsVector(t.slice(6,9)),o=e.transformAsVector(t.slice(9,12)),a=new m.a([i[0],i[1],i[2],s[0],s[1],s[2],o[0],o[1],o[2]]);if(Ti(r))return r.center=n,r.halfAxes=a,r;return new cn(n,a)}(t.box,e,r);if(t.region){const[e,r,n,i,s,o]=t.region,a=Qe.WGS84.cartographicToCartesian([Object(m.j)(e),Object(m.j)(i),s],Ei),u=Qe.WGS84.cartographicToCartesian([Object(m.j)(n),Object(m.j)(r),o],Si),c=(new m.e).addVectors(a,u).multiplyScalar(.5),h=(new m.e).subVectors(a,u).len()/2;return ki([c[0],c[1],c[2],h],new m.b)}if(t.sphere)return ki(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function ki(t,e,r){const n=new m.e(t[0],t[1],t[2]);e.transform(n,n);const i=e.getScale(Oi),s=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*s;return Ti(r)?(r.center=n,r.radius=o,r):new Or(n,o)}const xi=t=>null!=t,Ni=new m.e;class Mi{constructor(t,e,r,n){O("object"==typeof e),this._tileset=t,this._header=e,this._basePath=n,this._content=null,this._contentState=h.UNLOADED,this._gpuMemoryUsageInBytes=0,this.parent=r,this.children=[],this.refine=this._getRefine(e.refine),this.cacheNode=void 0,this.userData={},"geometricError"in e?this.geometricError=e.geometricError:(this.geometricError=this.parent&&this.parent.geometricError||t.geometricError,console.warn("3D Tile: Required prop geometricError is undefined. Using parent error")),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeCache(e),this._optimChildrenWithinParent=l.NOT_COMPUTED,this._initializeRenderingState(),Object.seal(this)}destroy(){this._header=null}isDestroyed(){return null===this._header}get gpuMemoryUsageInBytes(){return this._gpuMemoryUsageInBytes}get tileset(){return this._tileset}get depth(){return this._depth}get selectedFrame(){return this._selectedFrame}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get content(){return this._content}get contentReady(){return this._contentState===h.READY}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get contentAvailable(){return this.contentReady&&this.hasRenderContent||xi(this._expiredContent)&&!this.contentFailed}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this._contentState===h.UNLOADED}get contentExpired(){return this._contentState===h.EXPIRED}get contentFailed(){return this._contentState===h.FAILED}get url(){return this.tileset.getTileUrl(this.contentUri,this._basePath)}get uri(){return this.tileset.getTileUrl(this.contentUri,this._basePath)}get boundingVolume(){return this._boundingVolume}get contentBoundingVolume(){return this._contentBoundingVolume||this._boundingVolume}get boundingSphere(){return this._boundingVolume.boundingSphere}get extras(){return this._header.extras}get hasChildren(){return this.children.length>0||this._header.children&&this.children.length>0}getScreenSpaceError(t,e){const r=this._tileset,n=this.parent&&this.parent.geometricError||r.geometricError,i=e?n:this.geometricError;if(0===i)return 0;const s=Math.max(this._distanceToCamera,1e-7),{height:o,sseDenominator:a}=t;let u=i*o/(s*a);return u-=this._getDynamicScreenSpaceError(s),u}_getDynamicScreenSpaceError(t){const e=this._tileset;if(e.dynamicScreenSpaceError&&e._dynamicScreenSpaceErrorComputedDensity){const r=e._dynamicScreenSpaceErrorComputedDensity,n=e.dynamicScreenSpaceErrorFactor;return function(t,e){const r=t*e;return 1-Math.exp(-r*r)}(t,r)*n}return 0}async loadContent(t){if(this.hasEmptyContent)return!1;if(this._content)return!0;if(this.contentExpired&&(this.expireDate=void 0),this._contentState=h.LOADING,!await this.tileset._requestScheduler.scheduleRequest(this,(function(t){return t._visible?t._contentState===h.UNLOADED?-1:Math.max(1e7-t._priority,0)||0:-1})))return this._contentState=h.UNLOADED,!1;try{const t=this.uri;let e;try{this.tileset._requestScheduler.startRequest(this),e=await Bn(t,this.tileset.options.fetchOptions)}finally{this.tileset._requestScheduler.endRequest(this)}return this._content=await wi(e,[Ke,a]),-1!==t.indexOf(".json")&&this._tileset._initializeTileHeaders(this._content,this,o.dirname(this.uri)),this._contentState=h.READY,this._contentLoaded(),!0}catch(t){throw this._contentState=h.FAILED,t}}unloadContent(){return!!this.hasRenderContent&&(this._content&&this._content.destroy&&this._content.destroy(),this._content=null,this._contentState=h.UNLOADED,!0)}updateVisibility(t){const e=this._tileset;if(this._frameNumber===e._frameNumber)return;const r=this.parent,n=r?r.computedTransform:this._tileset.modelMatrix,i=r?r._visibilityPlaneMask:pn.MASK_INDETERMINATE;this._updateTransform(n),this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,i),this._visible=this._visibilityPlaneMask!==pn.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=e._frameNumber}updateExpiration(){if(xi(this.expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this.expireDate,t)&&(this._contentState=h.EXPIRED,this._expiredContent=this._content)}}visibility(t,e){const{cullingVolume:r}=t,{boundingVolume:n,tileset:i}=this,{clippingPlanes:s,clippingPlanesOriginMatrix:o}=i;if(s&&s.enabled){const t=s.computeIntersectionWithBoundingVolume(n,o);if(this._isClipped=t!==pr.INSIDE,t===pr.OUTSIDE)return pn.MASK_OUTSIDE}return r.computeVisibilityWithPlaneMask(n,e)}contentVisibility(t){return!0}distanceToTile(t){const e=this._boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const e=this.boundingVolume;return Ni.subVectors(e.center,t.position),t.direction.dot(Ni)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||0===e.distanceToCamera(t)}_initializeCache(t){this.cacheNode=void 0;const e=t.expire;let r,n;e&&(r=e.duration,e.date&&(n=Date.fromIso8601(e.date))),this.expireDuration=r,this.expireDate=n}_initializeTransforms(t){this.transform=t.transform?new m.b(t.transform):new m.b;const e=this.parent,r=this._tileset,n=e&&e.computedTransform?e.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new m.b(n).multiplyRight(this.transform);const i=e&&e._initialTransform?e._initialTransform.clone():new m.b;this._initialTransform=new m.b(i).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._boundingVolume=Ai(t.boundingVolume,this.computedTransform),this._contentBoundingVolume=null,this._viewerRequestVolume=null,t.content&&t.content.boundingVolume&&(this._contentBoundingVolume=Ai(t.boundingVolume,this.computedTransform)),t.viewerRequestVolume&&(this._viewerRequestVolume=Ai(t.viewerRequestVolume,this.computedTransform))}_initializeContent(t){this._content={_tileset:this._tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=h.UNLOADED,this._expiredContent=void 0,this._serverKey=null,this.hasTilesetContent=!1,t.content&&(this.contentUri=t.content.uri||t.content.url,"url"in t&&(console.warn('Tileset 3D: "content.url" property deprecated. Use "content.uri" instead.'),this.contentUri=t.url),this._content=null,this.hasEmptyContent=!1,this.contentState=h.UNLOADED,this.fullUri=`${this._basePath}/${this.contentUri}`,this.id=this.fullUri)}_initializeRenderingState(){this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=pn.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._priority=0}_getRefine(t){switch(t){case"REPLACE":case"replace":return f.REPLACE;case"ADD":case"add":return f.ADD;default:return this.parent?this.parent.refine:f.REPLACE}}_isTileset(t){return Boolean(t.asset)}_contentLoaded(){switch(this._content&&this._content.type){case"vctr":case"geom":this.tileset.traverser.disableSkipLevelOfDetail=!0}this._isTileset(this._content)&&(this.hasTilesetContent=!0)}_updateTransform(t=new m.b){const e=t.clone().multiplyRight(this.transform);if(!!e.equals(this.computedTransform))return;this.computedTransform=e;const r=this._header,n=this._header.content;this._boundingVolume=Ai(r.boundingVolume,this.computedTransform,this._boundingVolume),this._contentBoundingVolume&&(this._contentBoundingVolume=Ai(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),this._viewerRequestVolume&&(this._viewerRequestVolume=Ai(r.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume))}}class Ii{constructor(t=0){this._array=new Array(t),this._map=new Map,this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return O(t<this._array.length),this._array[t]}set(t,e){O(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){O(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){O(t>=0),this.length=t}trim(t){null==t&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const ji={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2};class Ri{constructor(t){this.options={...ji,...t},this._traversalStack=new Ii,this._emptyTraversalStack=new Ii,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}traverse(t,e,r){return this.root=t,this.options={...this.options,...r},this.reset(),this.updateTile(t,e),!!this.canTraverse(t,e,!0)&&(this._frameNumber=e.frameNumber,this.executeTraversal(t,e),!0)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const r=this._traversalStack;for(r.push(t);r.length>0;){const t=r.pop();let n=!1;this.canTraverse(t,e)&&(this.updateChildTiles(t,e),n=this.updateAndPushChildren(t,e,r));const i=t.parent,s=Boolean(!i||i._refines),o=!n;t.hasRenderContent?t.refine===f.ADD?(this.loadTile(t,e),this.selectTile(t,e)):t.refine===f.REPLACE&&(this.loadTile(t,e),o&&this.selectTile(t,e)):(this.emptyTiles[t.id]=t,this.loadTile(t,e),o&&this.selectTile(t,e)),this.touchTile(t,e),t._refines=n&&s}this.options.onTraverseEnd&&this.options.onTraverseEnd()}updateChildTiles(t,e){const r=t.children;for(const t of r)this.updateTile(t,e);return!0}updateAndPushChildren(t,e,r){const{loadSiblings:n,skipLevelOfDetail:i}=this.options,s=t.children;s.sort(this.compareDistanceToCamera);const o=!i&&t.refine===f.REPLACE&&t.hasRenderContent;let a=!0,u=!1;for(const t of s)if(t.isVisibleAndInRequestVolume?(r.find(t)&&r.delete(t),r.push(t),u=!0):(o||n)&&(this.loadTile(t,e),this.touchTile(t,e)),o){let r;r=!!t._inRequestVolume&&(t.hasRenderContent?t.contentAvailable:this.executeEmptyTraversal(t,e)),a=a&&r}return u||(a=!1),a}updateTile(t,e){this.updateTileVisibility(t,e),t.updateExpiration()}selectTile(t,e){this.shouldSelectTile(t,e)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.fullUri]=t)}loadTile(t,e){this.shouldLoadTile(t,e)&&(t._requestedFrame=e.frameNumber,t._priority=this.getPriority(t),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e,r=!1,n=!1){return!(!n&&!t.isVisibleAndInRequestVolume)&&(!!t.hasChildren&&(t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,e,r)))}shouldLoadTile(t,e){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t,e){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e,r){let n=t._screenSpaceError;return r&&(n=t.getScreenSpaceError(e,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){t.updateVisibility(e)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}getPriority(t){const{options:e}=this;switch(t.refine){case f.ADD:return t._distanceToCamera;case f.REPLACE:const{parent:r}=t,n=r&&(!e.skipLevelOfDetail||0===t._screenSpaceError||r.hasTilesetContent)?r._screenSpaceError:t._screenSpaceError;return this.root._screenSpaceError-n;default:return O(!1)}}anyChildrenVisible(t,e){let r=!1;for(const n of t.children)n.updateVisibility(e),r=r||n.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(t,e){let r=!0;const n=this._emptyTraversalStack;for(;n.length>0;){const t=n.pop();this.updateTile(t,e),t.isVisibleAndInRequestVolume||(this.loadTile(t,e),this.touchTile(t,e));const i=!t.hasRenderContent&&this.canTraverse(t,e,!1,!0);if(i||t.contentAvailable||(r=!1),i){const e=t.children.filter(t=>t);for(const t of e)n.find(t)&&n.delete(t),n.push(t)}}return r}}class Ci extends Ri{compareDistanceToCamera(t,e){return 0===e._distanceToCamera&&0===t._distanceToCamera?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(t.updateVisibility(e),!t.isVisibleAndInRequestVolume)return;const r=t.children.length>0;if(t.hasTilesetContent&&r){const r=t.children[0];return this.updateTileVisibility(r,e),void(t._visible=r._visible)}if(this.meetsScreenSpaceErrorEarly(t,e))return void(t._visible=!1);const n=t.refine===f.REPLACE,i=t._optimChildrenWithinParent===l.USE_OPTIMIZATION;n&&i&&r&&!this.anyChildrenVisible(t,e)&&(t._visible=!1)}meetsScreenSpaceErrorEarly(t,e){const{parent:r}=t;return!(!r||r.hasTilesetContent||r.refine!==f.ADD)&&!this.shouldRefine(t,e,!0)}}class Pi{constructor(t,e,r){this.item=t,this.previous=e,this.next=r}}const Li=t=>void 0!==t;class Di{constructor(){this.head=void 0,this.tail=void 0,this._length=0}get length(){return this._length}add(t){const e=new Pi(t,this.tail,void 0);return Li(this.tail)?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){Li(t)&&(Li(t.previous)&&Li(t.next)?(t.previous.next=t.next,t.next.previous=t.previous):Li(t.previous)?(t.previous.next=void 0,this.tail=t.previous):Li(t.next)?(t.next.previous=void 0,this.head=t.next):(this.head=void 0,this.tail=void 0),t.next=void 0,t.previous=void 0,--this._length)}splice(t,e){if(t===e)return;this.remove(e);const r=t.next;t.next=e,this.tail===t?this.tail=e:r.previous=e,e.next=r,e.previous=t}}const Ui=t=>void 0!==t;class Bi{constructor(){this._list=new Di,this._sentinel=this._list.add(),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t.cacheNode;Ui(e)&&this._list.splice(this._sentinel,e)}add(t,e,r){Ui(e.cacheNode)||(e.cacheNode=this._list.add(e),r&&r(t,e))}unloadTile(t,e,r){const n=e.cacheNode;Ui(n)&&(this._list.remove(n),e.cacheNode=void 0,r&&r(t,e))}unloadTiles(t,e){const r=this._trimTiles;this._trimTiles=!1;const n=this._list,i=1024*t.maximumMemoryUsage*1024,s=this._sentinel;let o=n.head;for(;o!==s&&(t.gpuMemoryUsageInBytes>i||r);){const r=o.item;o=o.next,this.unloadTile(t,r,e)}}trim(){this._trimTiles=!0}}const Vi="Tiles In Tileset(s)",qi="Tiles In Memory",Fi="Tiles In View",zi="Tiles To Render",Gi="Tiles Loaded",$i="Tiles Loading",Hi="Tiles Unloaded",Wi="Failed Tile Loads",Qi="Points",Yi="Tile Memory Use",Zi=6378137,Ki=6378137,Ji=6356752.314245179,Xi=new m.e;const ts={basePath:"",ellipsoid:Qe.WGS84,modelMatrix:new m.b,throttleRequests:!1,maximumScreenSpaceError:8,maximumMemoryUsage:32,dynamicScreenSpaceError:!1,dynamicScreenSpaceErrorDensity:.00278,dynamicScreenSpaceErrorFactor:4,skipLevelOfDetail:!1,baseScreenSpaceError:1024,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:(t,e,r)=>{}};class es{constructor(t,e,r={}){O(t),this.options={...ts,...r},this.url=e,this.basePath=o.dirname(e),this.modelMatrix=this.options.modelMatrix,this.stats=new ar({id:e}),this._initializeStats(),this.gpuMemoryUsageInBytes=0,this.geometricError=void 0,this.userData={},this._queryParams={},this._requestScheduler=new mr({throttleRequests:this.options.throttleRequests}),this._traverser=new Ci,this._cache=new Bi,this._processingQueue=[],this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this.asset={},this.credits={},this.description=this.options.description,this._root=void 0,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._loadTimestamp=void 0,this._timeSinceLoad=0,this._frameNumber=0,this._extras=void 0,this._allTilesAdditive=!0,this._hasMixedContent=!1,this._maximumScreenSpaceError=this.options.maximumScreenSpaceError,this._maximumMemoryUsage=this.options.maximumMemoryUsage,this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._readyPromise=Promise.resolve(),this._classificationType=this.options.classificationType,this._ellipsoid=this.options.ellipsoid,this._dynamicScreenSpaceErrorComputedDensity=0,this._initializeTileSet(t,this.options)}destroy(){this._destroy()}get traverser(){return this._traverser}get properties(){return this._properties}get ready(){return Boolean(this._root)}get readyPromise(){return this._readyPromise.promise}get tilesLoaded(){return this._tilesLoaded}get queryParams(){return function(t){const e=[];for(const r of Object.keys(t))e.push(`${r}=${t[r]}`);switch(e.length){case 0:return"";case 1:return`?${e[0]}`;default:return`?${e.join("&")}`}}(this._queryParams)}get root(){return this._root}get boundingSphere(){return this._checkReady(),this._root.updateTransform(this.modelMatrix),this._root.boundingSphere}get timeSinceLoad(){return this._timeSinceLoad}get maximumMemoryUsage(){return this._maximumMemoryUsage}set maximumMemoryUsage(t){O(t>0),this._maximumMemoryUsage=t}get ellipsoid(){return this.options.ellipsoid}get extras(){return this._extras}getTileUrl(t,e){return t.startsWith("data:")?t:`${e||this.basePath}/${t}${this.queryParams}`}hasExtension(t){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(t)>-1)}update(t){let e;this._frameNumber++,e="frameNumber"in t?t:In(t,this._frameNumber),this._cache.reset(),this._traverser.traverse(this.root,e,this.options),this._requestedTiles=Object.values(this._traverser.requestedTiles),this.selectedTiles=Object.values(this._traverser.selectedTiles),this._emptyTiles=Object.values(this._traverser.emptyTiles);const r=this._requestedTiles;for(const t of r)this._loadTile(t,e);this._unloadTiles();let n=0,i=0;for(const t of this.selectedTiles)t.contentAvailable&&(n++,t.content.pointCount&&(i+=t.content.pointCount));return this.stats.get(Fi).count=this.selectedTiles.length,this.stats.get(zi).count=n,this.stats.get(Qi).count=i,e.frameNumber}trimLoadedTiles(){this._cache.trim()}addTileToCache(t){this._cache.add(this,t,(t,e)=>t._addTileToCache(e))}_initializeTileSet(t,e){if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:e.attributions||[]},this._properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed,this._extras=t.extras,this._root=this._initializeTileHeaders(t,null,this.basePath),this._calculateViewProps()}_calculateViewProps(){const t=this._root,{center:e}=t.boundingVolume;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new m.e,void(this.zoom=16);this.cartographicCenter=Qe.WGS84.cartesianToCartographic(e,new m.e),this.cartesianCenter=e,this.zoom=function(t){const{halfAxes:e,radius:r,width:n,height:i}=t;if(e){e.getColumn(0,Xi);const t=Xi.len();e.getColumn(1,Xi);const r=Xi.len();e.getColumn(2,Xi);const n=Xi.len();return(Math.log2(Zi/t/2)+Math.log2(Ki/r/2)+Math.log2(Ji/n/2))/3}if(r)return Math.log2(Ji/r);if(i&&n){return(Math.log2(Zi/n)+Math.log2(Ki/i))/2}return 18}(t.boundingVolume)}_initializeStats(){this.stats.get(Vi),this.stats.get($i),this.stats.get(qi),this.stats.get(Fi),this.stats.get(zi),this.stats.get(Gi),this.stats.get(Hi),this.stats.get(Wi),this.stats.get(Qi,"memory"),this.stats.get(Yi,"memory")}_initializeTileHeaders(t,e,r){const n=new Mi(this,t.root,e,r);e&&(e.children.push(n),n._depth=e._depth+1);const i=[];for(i.push(n);i.length>0;){const t=i.pop();this.stats.get(Vi).incrementCount();const e=t._header.children||[];for(const n of e){const e=new Mi(this,n,t,r);t.children.push(e),e._depth=t._depth+1,i.push(e)}}return n}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t,e){let r;this.stats.get($i).incrementCount();try{r=await t.loadContent(e)}catch(e){this.stats.get($i).decrementCount(),this.stats.get(Wi).incrementCount();const r=e.message||e.toString(),n=t.url;return console.error(`A 3D tile failed to load: ${t.url} ${r}`),void this.options.onTileError(t,r,n)}this.stats.get($i).decrementCount(),r&&(t&&t._content&&jn(t,t._content),this.options.onTileLoad(t))}_addTileToCache(t){this.stats.get(Gi).incrementCount(),this.stats.get(qi).incrementCount(),this.gpuMemoryUsageInBytes+=t._content.byteLength||0,this.stats.get(Yi).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.stats.get(qi).decrementCount(),this.stats.get(Hi).incrementCount(),this.gpuMemoryUsageInBytes-=t._content.byteLength||0,this.stats.get(Yi).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_destroy(){const t=[];for(this._root&&t.push(this._root);t.length>0;){const e=t.pop();for(const r of e.children)t.push(r);e.destroy()}this._root=null}_destroySubtree(t){const e=t,r=[];for(r.push(e);r.length>0;){t=r.pop();for(const e of t.children)r.push(e);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}}async function rs(t){let e=`Failed to fetch resource ${t.url} (${t.status}): `;try{t.headers.get("Content-Type").includes("application/json")?e+=await t.text():e+=t.statusText}catch(t){return e}return e}const ns="https://api.cesium.com/v1/assets";async function is(t,e){if(!e){const r=await async function(t){O(t);const e=ns,r={Authorization:`Bearer ${t}`},n=await fetch(e,{headers:r});if(!n.ok)throw new Error(await rs(n));return await n.json()}(t);for(const t of r.items)"3DTILES"===t.type&&(e=t.id)}const r=await async function(t,e){O(t,e);const r={Authorization:`Bearer ${t}`},n=`${ns}/${e}`;let i=await fetch(`${n}`,{headers:r});if(!i.ok)throw new Error(await rs(i));let s=await i.json();if(i=await fetch(`${n}/endpoint`,{headers:r}),!i.ok)throw new Error(await rs(i));const o=await i.json();return s={...s,...o},s}(t,e),{type:n,url:i}=r;return O("3DTILES"===n&&i),r.headers={Authorization:`Bearer ${r.accessToken}`},r}r.d(e,"Tileset3DLoader",(function(){return a})),r.d(e,"Tile3DLoader",(function(){return Ke})),r.d(e,"Tile3DWriter",(function(){return ir})),r.d(e,"Tileset3D",(function(){return es})),r.d(e,"Tile3DFeatureTable",(function(){return T})),r.d(e,"Tile3DBatchTable",(function(){return C})),r.d(e,"TILE3D_TYPE",(function(){return u})),r.d(e,"_getIonTilesetMetadata",(function(){return is})),r.d(e,"_BaseTilesetTraverser",(function(){return Ri})),r.d(e,"_Tileset3DCache",(function(){return Bi})),r.d(e,"_RequestScheduler",(function(){return mr})),r.d(e,"_getFrameState",(function(){return In})),r.d(e,"createBoundingVolume",(function(){return Ai})),r.d(e,"calculateTransformProps",(function(){return jn}))},,function(t,e,r){"use strict";(function(t,n){r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return o}));"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof document&&document;const i="object"!=typeof n||"[object process]"!==String(n)||n.browser,s=void 0!==n&&n.version&&n.version.match(/v([0-9]*)/),o=s&&parseFloat(s[1])||0}).call(this,r(24),r(30))}])}));